<!-- app.component.html -->
<div class="app-container">
  <!-- Sidebar -->
  <nav *ngIf="showSidebar" class="sidebar" [class.open]="isMobileSidebarOpen">
    <div class="sidebar-header">
      <div class="brand">
        <div class="brand-mark">CD</div>
        <div class="brand-text">
          <h5>Centro Dermatol√≥gico</h5>
          <small class="subtitle">Cuidado y bienestar</small>
        </div>
        <button type="button" class="theme-toggle" (click)="toggleTheme()" [attr.aria-pressed]="isDarkTheme" [title]="isDarkTheme ? 'Tema oscuro' : 'Tema claro'">
          <span class="icon" [class.dark]="isDarkTheme" aria-hidden="true">{{ isDarkTheme ? 'üåô' : '‚òÄÔ∏è' }}</span>
        </button>
      </div>
    </div>
    
    <ul class="sidebar-nav">
      <li *ngFor="let item of navigationItems" 
          [class.active]="isActiveRoute(item.path)">
        <a [routerLink]="item.path" class="nav-link" (click)="isMobileSidebarOpen && toggleMobileSidebar()">
          <i [class]="item.icon"></i>
          <span>{{ item.label }}</span>
        </a>
      </li>
      <!-- Admin quick actions inserted into main nav (visible only to administrators) -->
      <li *ngIf="userRole==='administrador'" [class.active]="isActiveRoute('/mission-vision')">
        <a [routerLink]="['/mission-vision']" class="nav-link d-flex align-items-center" (click)="isMobileSidebarOpen && toggleMobileSidebar()">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right:12px">
            <path d="M12 2L2 7l10 5 10-5-10-5z" />
            <path d="M2 17l10 5 10-5" />
            <path d="M2 12l10 5 10-5" />
          </svg>
          <span>Misi√≥n / Visi√≥n</span>
        </a>
      </li>
      <li *ngIf="userRole==='administrador'" [class.active]="isActiveRoute('/audit-history')">
        <a [routerLink]="['/audit-history']" class="nav-link d-flex align-items-center" (click)="isMobileSidebarOpen && toggleMobileSidebar()">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right:12px">
            <circle cx="12" cy="12" r="10"></circle>
            <polyline points="12 6 12 12 16 14"></polyline>
          </svg>
          <span>Historial</span>
        </a>
      </li>
    </ul>
    
    <div class="sidebar-footer">
      <div class="user-card">
        <div class="avatar" aria-hidden="true">{{ userInitials }}</div>
        <div class="user-info">
          <small>Bienvenido,</small>
          <strong class="user-name text-ellipsis" [title]="userName">{{ userName }}</strong>
          <small class="user-role">{{ userRole | titlecase }}</small>
        </div>
      </div>
      <button class="btn signout-btn" (click)="logout()" title="Cerrar sesi√≥n">
        <i class="fas fa-sign-out-alt"></i>
        <span>Cerrar Sesi√≥n</span>
      </button>
    </div>
  </nav>

  <!-- Main Content -->
  <div class="main-content" [class.with-sidebar]="showSidebar">
    <!-- Mobile topbar (hamburger) -->
    <div class="mobile-topbar d-sm-none">
      <button class="hamburger" type="button" (click)="toggleMobileSidebar()">
        <span></span><span></span><span></span>
      </button>
      <div class="topbar-title">{{ title }}</div>
    </div>

    <!-- Router Content -->
    <div class="content-wrapper">
      <router-outlet></router-outlet>
    </div>
  </div>

  <!-- Backdrop for mobile sidebar -->
  <div class="sidebar-backdrop" *ngIf="showSidebar && isMobileSidebarOpen" (click)="toggleMobileSidebar()"></div>
</div>

<!-- Global Toast Container -->
<ng-container *ngIf="toast$ | async as toast">
  <div *ngIf="toast" class="toast-container" [ngClass]="{'toast-success': toast.type==='success','toast-error': toast.type==='error'}">
    {{ toast.message }}
  </div>
</ng-container>
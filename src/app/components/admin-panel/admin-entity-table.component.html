<!-- Ficha de detalles -->
<div *ngIf="selectedItem" class="details-card">
  <div class="card mt-3">
    <div class="card-header d-flex align-items-center justify-content-between">
      <h4 class="m-0">Ficha de Detalles</h4>
      <button class="btn btn-sm btn-danger" (click)="selectedItem = null">Cerrar</button>
    </div>
    <div class="card-body">
      <table class="table table-sm table-modern table-card mb-0">
        <tbody>
          <tr *ngFor="let key of selectedItem | keyvalue">
            <th>{{ key.key?.toString() | titlecase }}</th>
            <td>{{ key.value }}</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
  
</div>

<div *ngIf="entity">
  <!-- Toolbar: título, búsqueda, refrescar -->
  <div class="toolbar d-flex align-items-center justify-content-between p-2 mb-3 flex-wrap gap-2">
    <div class="d-flex align-items-center gap-2 flex-wrap">
      <h3 class="m-0">{{ entity | titlecase }}</h3>
      <span class="badge-soft primary">Total: {{ totalItems || items.length }}</span>
    </div>
    <div class="d-flex align-items-center gap-2 flex-wrap">
      <div class="input-group">
        <span class="input-group-text"><i class="bi bi-search"></i></span>
        <input class="form-control" type="search" placeholder="Buscar..." [(ngModel)]="searchTerm" (ngModelChange)="onSearchChange()"/>
      </div>
      <button class="btn btn-outline-secondary" type="button" (click)="refresh()">
        <i class="bi bi-arrow-clockwise"></i>
        <span class="d-none d-sm-inline">Refrescar</span>
      </button>
    </div>
  </div>

  <!-- Estados de carga/vacío -->
  <div *ngIf="loading" class="text-center py-4">
    <small>Cargando…</small>
  </div>

  <div *ngIf="!loading && (items?.length || 0) === 0" class="text-center py-4">
    <p class="mb-0">No hay datos para mostrar.</p>
  </div>

  <div *ngIf="!loading && (items?.length || 0) > 0">
    <div *ngIf="filteredItems.length === 0" class="text-center py-4">
      <p class="mb-1">Sin resultados para "{{ searchTerm }}".</p>
      <button class="btn btn-sm btn-outline-secondary" (click)="searchTerm=''; onSearchChange()">Limpiar búsqueda</button>
    </div>

    <div class="table-responsive" *ngIf="filteredItems.length > 0">
      <table class="table table-sm app-table app-table--minwidth table-modern table-card">
        <thead>
          <tr>
            <th *ngFor="let key of (filteredItems[0] || items[0]) | keyvalue">{{ key.key?.toString() | titlecase }}</th>
            <th class="text-end">Acciones</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let item of paginatedItems; trackBy: trackById">
            <td *ngFor="let key of item | keyvalue">{{ key.value }}</td>
            <td class="text-end">
              <button class="btn btn-sm btn-primary" (click)="$event.stopPropagation(); showDetails(item)">
                <i class="bi bi-card-text"></i>
                <span class="d-none d-sm-inline">Más detalles</span>
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Paginación -->
    <nav *ngIf="totalPages > 1" class="mt-3" aria-label="Paginación de entidades">
      <ul class="pagination justify-content-center pagination-modern">
        <li class="page-item" [class.disabled]="currentPage === 1">
          <a class="page-link" href="javascript:void(0)" (click)="changePage(currentPage - 1)" aria-label="Anterior">
            <i class="bi bi-chevron-left"></i>
            <span class="d-none d-sm-inline">Anterior</span>
          </a>
        </li>
        <li *ngFor="let p of pageNumbers" class="page-item" [class.active]="currentPage === p">
          <a class="page-link" href="javascript:void(0)" (click)="changePage(p)" [attr.aria-label]="'Ir a página ' + p">{{ p }}</a>
        </li>
        <li class="page-item" [class.disabled]="currentPage === totalPages">
          <a class="page-link" href="javascript:void(0)" (click)="changePage(currentPage + 1)" aria-label="Siguiente">
            <span class="d-none d-sm-inline">Siguiente</span>
            <i class="bi bi-chevron-right"></i>
          </a>
        </li>
      </ul>
    </nav>

    <!-- Tamaño de página -->
    <div class="d-flex align-items-center justify-content-end gap-2 mt-2">
      <label class="mb-0 me-1">Por página:</label>
      <select class="form-select form-select-sm" [(ngModel)]="pageSize" (change)="onPageSizeChange()" style="max-width: 6rem;">
        <option [ngValue]="5">5</option>
        <option [ngValue]="10">10</option>
        <option [ngValue]="20">20</option>
        <option [ngValue]="50">50</option>
      </select>
    </div>
  </div>
 


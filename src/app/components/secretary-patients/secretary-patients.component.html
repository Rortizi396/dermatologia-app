<div class="container py-3">
  <div class="d-flex align-items-center justify-content-between mb-3">
    <h4 class="mb-0">Administración de Pacientes</h4>
    <div class="d-flex align-items-center gap-2">
      <input type="text" class="form-control" style="min-width:240px" [(ngModel)]="search" (ngModelChange)="applyFilters()" placeholder="Buscar por nombre, DPI, correo o teléfono" />
      <select class="form-select" [(ngModel)]="pageSize" (change)="changePageSize()" style="width:120px">
        <option *ngFor="let o of pageSizeOptions" [value]="o">{{ o }} / pág</option>
      </select>
    </div>
  </div>

  <div *ngIf="loading" class="alert alert-info">Cargando pacientes...</div>

  <div class="table-responsive shadow-sm rounded">
    <table class="table table-hover align-middle mb-0">
      <thead class="table-light">
        <tr>
          <th>DPI</th>
          <th>Nombre</th>
          <th class="d-none d-sm-table-cell">Teléfono</th>
          <th>Correo</th>
          <th class="d-none d-md-table-cell">Estado</th>
          <th style="width:160px">Acciones</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let p of paged">
          <td class="text-nowrap">{{ p.DPI }}</td>
          <td>
            <div class="fw-semibold">{{ p.Nombres }} {{ p.Apellidos }}</div>
            <small class="text-muted d-sm-none">Tel: {{ p.Telefono || '—' }}</small>
          </td>
          <td class="d-none d-sm-table-cell" *ngIf="editingDpi !== toStringVal(p.DPI)">{{ p.Telefono || '—' }}</td>
          <td class="d-none d-sm-table-cell" *ngIf="editingDpi === toStringVal(p.DPI)">
            <input type="text" class="form-control form-control-sm" [(ngModel)]="editTelefono" />
          </td>

          <td *ngIf="editingDpi !== toStringVal(p.DPI)">{{ p.Correo || '—' }}</td>
          <td *ngIf="editingDpi === toStringVal(p.DPI)">
            <input type="email" class="form-control form-control-sm" [(ngModel)]="editCorreo" />
          </td>

          <td class="d-none d-md-table-cell">
            <span class="badge" [ngClass]="(p.Activo || '').toUpperCase() === 'SI' ? 'bg-success' : 'bg-secondary'">
              {{ (p.Activo || '').toUpperCase() === 'SI' ? 'Activo' : 'Inactivo' }}
            </span>
          </td>

          <td>
            <div class="btn-group btn-group-sm" *ngIf="editingDpi !== toStringVal(p.DPI); else editActions">
              <button class="btn btn-outline-primary" (click)="startEdit(p)">Editar</button>
            </div>
            <ng-template #editActions>
              <div class="btn-group btn-group-sm">
                <button class="btn btn-success" (click)="saveEdit()">Guardar</button>
                <button class="btn btn-outline-secondary" (click)="cancelEdit()">Cancelar</button>
              </div>
            </ng-template>
          </td>
        </tr>
        <tr *ngIf="!loading && filtered.length === 0">
          <td colspan="6" class="text-center text-muted py-4">No se encontraron pacientes.</td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="d-flex align-items-center justify-content-between mt-3">
  <div class="text-muted">Mostrando {{ (page - 1) * pageSize + 1 }} - {{ min(page * pageSize, filtered.length) }} de {{ filtered.length }}</div>
    <div class="btn-group">
      <button class="btn btn-outline-secondary" (click)="prevPage()" [disabled]="page <= 1">Anterior</button>
      <button class="btn btn-outline-secondary" (click)="nextPage()" [disabled]="page >= totalPages">Siguiente</button>
    </div>
  </div>
</div>

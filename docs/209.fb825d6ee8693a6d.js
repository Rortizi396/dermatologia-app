"use strict";(self.webpackChunkdermatologia_app=self.webpackChunkdermatologia_app||[]).push([[209],{2209:(A,u,d)=>{d.r(u),d.d(u,{SecretaryPatientsComponent:()=>D});var g=d(2200),p=d(9417),c=d(2615),t=d(3664),m=d(9885),f=d(9330),h=d(8397);function C(i,l){if(1&i&&(t.j41(0,"option",43),t.EFF(1),t.k0s()),2&i){const e=l.$implicit;t.Y8G("value",e),t.R7$(),t.SpI("",e," / p\xe1g")}}function b(i,l){1&i&&(t.j41(0,"div",44),t.EFF(1,"Cargando pacientes..."),t.k0s())}function P(i,l){if(1&i&&(t.j41(0,"a",57),t.nrm(1,"i",58),t.EFF(2),t.k0s()),2&i){const e=t.XpG(2).$implicit;t.Y8G("href","tel:"+e.Telefono,t.B4B),t.R7$(2),t.SpI("",e.Telefono," ")}}function F(i,l){1&i&&(t.j41(0,"span",40),t.EFF(1,"\u2014"),t.k0s())}function S(i,l){if(1&i&&(t.j41(0,"td",34),t.DNE(1,P,3,2,"a",55)(2,F,2,0,"span",56),t.k0s()),2&i){const e=t.XpG().$implicit;t.R7$(),t.Y8G("ngIf",e.Telefono),t.R7$(),t.Y8G("ngIf",!e.Telefono)}}function y(i,l){if(1&i){const e=t.RV6();t.j41(0,"td",34)(1,"input",59),t.mxI("ngModelChange",function(n){c.eBV(e);const s=t.XpG(2);return t.DH7(s.editTelefono,n)||(s.editTelefono=n),c.Njj(n)}),t.k0s()()}if(2&i){const e=t.XpG(2);t.R7$(),t.R50("ngModel",e.editTelefono)}}function M(i,l){if(1&i){const e=t.RV6();t.qex(0),t.j41(1,"a",57),t.nrm(2,"i",61),t.EFF(3),t.k0s(),t.j41(4,"button",62),t.bIt("click",function(){c.eBV(e);const n=t.XpG(2).$implicit,s=t.XpG();return c.Njj(s.copy(n.Correo))}),t.nrm(5,"i",63),t.k0s(),t.bVm()}if(2&i){const e=t.XpG(2).$implicit;t.R7$(),t.Y8G("href","mailto:"+e.Correo,t.B4B),t.R7$(2),t.SpI("",e.Correo," ")}}function E(i,l){1&i&&(t.j41(0,"span",40),t.EFF(1,"\u2014"),t.k0s())}function I(i,l){if(1&i&&(t.j41(0,"td"),t.DNE(1,M,6,2,"ng-container",60)(2,E,2,0,"ng-template",null,1,t.C5r),t.k0s()),2&i){const e=t.sdS(3),o=t.XpG().$implicit,n=t.XpG();t.AVh("sorted-col",n.isSortedField("correo")),t.R7$(),t.Y8G("ngIf",o.Correo)("ngIfElse",e)}}function v(i,l){if(1&i){const e=t.RV6();t.j41(0,"td")(1,"input",64),t.mxI("ngModelChange",function(n){c.eBV(e);const s=t.XpG(2);return t.DH7(s.editCorreo,n)||(s.editCorreo=n),c.Njj(n)}),t.k0s()()}if(2&i){const e=t.XpG(2);t.R7$(),t.R50("ngModel",e.editCorreo)}}function k(i,l){if(1&i){const e=t.RV6();t.j41(0,"div",65)(1,"button",66),t.bIt("click",function(){c.eBV(e);const n=t.XpG().$implicit,s=t.XpG();return c.Njj(s.startEdit(n))}),t.nrm(2,"i",67),t.EFF(3,"Editar"),t.k0s()()}}function R(i,l){if(1&i){const e=t.RV6();t.j41(0,"div",65)(1,"button",68),t.bIt("click",function(){c.eBV(e);const n=t.XpG(2);return c.Njj(n.saveEdit())}),t.EFF(2,"Guardar"),t.k0s(),t.j41(3,"button",69),t.bIt("click",function(){c.eBV(e);const n=t.XpG(2);return c.Njj(n.cancelEdit())}),t.EFF(4,"Cancelar"),t.k0s()()}}function j(i,l){if(1&i&&(t.j41(0,"tr")(1,"td",45),t.EFF(2),t.k0s(),t.j41(3,"td")(4,"div",46)(5,"div",47),t.EFF(6),t.k0s(),t.j41(7,"span"),t.EFF(8),t.k0s()(),t.j41(9,"small",48),t.EFF(10),t.k0s(),t.j41(11,"div",49),t.EFF(12),t.k0s()(),t.DNE(13,S,3,2,"td",50)(14,y,2,1,"td",50)(15,I,4,4,"td",51)(16,v,2,1,"td",38),t.j41(17,"td",35)(18,"span",52),t.nrm(19,"i",53),t.EFF(20),t.k0s()(),t.j41(21,"td"),t.DNE(22,k,4,0,"div",54)(23,R,5,0,"ng-template",null,0,t.C5r),t.k0s()()),2&i){const e=l.$implicit,o=t.sdS(24),n=t.XpG();t.R7$(),t.AVh("sorted-col",n.isSortedField("dpi")),t.R7$(),t.JRh(e.DPI),t.R7$(),t.AVh("sorted-col",n.isSortedField("apellidos")||n.isSortedField("nombres")),t.R7$(2),t.Y8G("ngStyle",n.avatarStyle(e)),t.R7$(),t.SpI(" ",n.initials(e)," "),t.R7$(2),t.Lme("",e.Nombres," ",e.Apellidos),t.R7$(2),t.SpI("Tel: ",e.Telefono||"\u2014"),t.R7$(2),t.SpI("DPI: ",e.DPI),t.R7$(),t.Y8G("ngIf",n.editingDpi!==n.toStringVal(e.DPI)),t.R7$(),t.Y8G("ngIf",n.editingDpi===n.toStringVal(e.DPI)),t.R7$(),t.Y8G("ngIf",n.editingDpi!==n.toStringVal(e.DPI)),t.R7$(),t.Y8G("ngIf",n.editingDpi===n.toStringVal(e.DPI)),t.R7$(2),t.Y8G("ngClass","SI"===(e.Activo||"").toUpperCase()?"bg-success":"bg-secondary"),t.R7$(),t.Y8G("ngClass","SI"===(e.Activo||"").toUpperCase()?"fa-check":"fa-minus"),t.R7$(),t.SpI(" ","SI"===(e.Activo||"").toUpperCase()?"Activo":"Inactivo"," "),t.R7$(2),t.Y8G("ngIf",n.editingDpi!==n.toStringVal(e.DPI))("ngIfElse",o)}}function T(i,l){1&i&&(t.j41(0,"tr")(1,"td",70),t.EFF(2,"No se encontraron pacientes."),t.k0s()())}let D=(()=>{class i{userService;http;toast;patients=[];filtered=[];loading=!1;page=1;pageSize=10;pageSizeOptions=[5,10,20,50];totalPages=1;search="";sortBy="apellidos";sortDir="asc";statusFilter="todos";totalCount=0;activeCount=0;inactiveCount=0;editingDpi=null;editTelefono="";editCorreo="";constructor(e,o,n){this.userService=e,this.http=o,this.toast=n}ngOnInit(){this.loadPatients()}loadPatients(){this.loading=!0,this.userService.getPacientes(!0).subscribe({next:e=>{const o=Array.isArray(e)?e:e.data||e||[];this.patients=(o||[]).map(n=>this.normalizePatient(n)),this.totalCount=this.patients.length,this.activeCount=this.patients.filter(n=>"SI"===n.Activo).length,this.inactiveCount=this.totalCount-this.activeCount,this.applyFilters(),this.loading=!1},error:e=>{console.error("Error cargando pacientes",e),this.loading=!1,this.toast.show("Error cargando pacientes","error")}})}applyFilters(){const e=(this.search||"").toLowerCase().trim();let o=[...this.patients];if("todos"!==this.statusFilter){const r="activos"===this.statusFilter;o=o.filter(a=>(a.Activo||"NO")===(r?"SI":"NO"))}e&&(o=o.filter(r=>{const a=`${r.Nombres||""} ${r.Apellidos||""}`.toLowerCase(),_=(r.Correo||"").toLowerCase(),O=String(r.DPI||""),$=String(r.Telefono||"");return a.includes(e)||_.includes(e)||O.includes(e)||$.includes(e)}));const n="asc"===this.sortDir?1:-1,s=r=>{switch(this.sortBy){case"nombres":return`${r.Nombres||""}`.toLowerCase();case"dpi":return String(r.DPI||"");case"correo":return`${r.Correo||""}`.toLowerCase();default:return`${r.Apellidos||""}`.toLowerCase()}};o.sort((r,a)=>s(r)>s(a)?1*n:s(r)<s(a)?-1*n:0),this.filtered=o,this.page=1,this.recalcPages()}recalcPages(){this.totalPages=Math.max(1,Math.ceil(this.filtered.length/this.pageSize))}get paged(){const e=(this.page-1)*this.pageSize;return this.filtered.slice(e,e+this.pageSize)}prevPage(){this.page>1&&this.page--}nextPage(){this.page<this.totalPages&&this.page++}changePageSize(){this.page=1,this.recalcPages()}startEdit(e){this.editingDpi=String(e.DPI),this.editTelefono=e.Telefono||"",this.editCorreo=e.Correo||""}cancelEdit(){this.editingDpi=null,this.editTelefono="",this.editCorreo=""}saveEdit(){this.editingDpi&&this.userService.updateUserByType("pacientes",this.editingDpi,{Telefono:this.editTelefono,Correo:this.editCorreo}).subscribe({next:()=>{this.cancelEdit(),this.toast.show("Paciente actualizado"),this.loadPatients()},error:n=>{console.error("Error guardando paciente",n),this.toast.show("Error al guardar cambios","error")}})}toStringVal(e){try{return String(e??"")}catch{return""}}min(e,o){return Math.min(e,o)}normalizePatient(e){const o=(a,_)=>typeof a<"u"&&null!==a&&""!==a?a:_,s=o(e.Activo,o(e.activo,"SI")),r=(()=>{const a=(""+s).toUpperCase();return"SI"===a||"S"===a||"TRUE"===a||"1"===a?"SI":"NO"})();return{...e,DPI:o(e.DPI,o(e.dpi,o(e.id,""))),Nombres:o(e.Nombres,e.nombres||""),Apellidos:o(e.Apellidos,e.apellidos||""),Telefono:o(e.Telefono,e.telefono||""),Correo:o(e.Correo,e.correo||""),Activo:r}}setSort(e){this.sortBy===e?this.sortDir="asc"===this.sortDir?"desc":"asc":(this.sortBy=e,this.sortDir="asc"),this.applyFilters()}sortArrow(e){return this.sortBy!==e?"":"asc"===this.sortDir?"\u25b2":"\u25bc"}isSortedField(e){return this.sortBy===e}initials(e){const o=(e.Nombres||"").trim(),n=(e.Apellidos||"").trim();return(o?o.charAt(0).toUpperCase():"")+(n?n.charAt(0).toUpperCase():"")||"\xb7"}avatarStyle(e){const o=`${e.Nombres||""}${e.Apellidos||""}${e.Correo||""}`;let n=0;for(let r=0;r<o.length;r++)n=31*n+o.charCodeAt(r)|0;return{backgroundColor:`hsl(${Math.abs(n)%360}, 70%, 50%)`}}copy(e){if(e)if(navigator&&navigator.clipboard&&navigator.clipboard.writeText)navigator.clipboard.writeText(e).then(()=>this.toast.show("Copiado al portapapeles"));else{const o=document.createElement("textarea");o.value=e,document.body.appendChild(o),o.select();try{document.execCommand("copy"),this.toast.show("Copiado al portapapeles")}catch{}document.body.removeChild(o)}}static \u0275fac=function(o){return new(o||i)(t.rXU(m.D),t.rXU(f.Qq),t.rXU(h.f))};static \u0275cmp=t.VBU({type:i,selectors:[["app-secretary-patients"]],decls:74,vars:26,consts:[["editActions",""],["noMail",""],[1,"container-xxl","py-3"],[1,"d-flex","flex-column","flex-lg-row","align-items-lg-center","justify-content-between","gap-2","mb-3"],[1,"mb-0"],[1,"d-flex","flex-wrap","align-items-center","gap-2"],[1,"input-group",2,"min-width","280px"],[1,"input-group-text"],[1,"fas","fa-search"],["type","text","placeholder","Buscar por nombre, DPI, correo o tel\xe9fono",1,"form-control",3,"ngModelChange","ngModel"],[1,"d-flex","align-items-center","gap-2"],[1,"form-select",2,"width","160px",3,"ngModelChange","change","ngModel"],["value","todos"],["value","activos"],["value","inactivos"],[1,"form-select",2,"width","170px",3,"ngModelChange","change","ngModel"],["value","apellidos"],["value","nombres"],["value","dpi"],["value","correo"],[1,"form-select",2,"width","120px",3,"ngModelChange","change","ngModel"],["value","asc"],["value","desc"],[3,"value",4,"ngFor","ngForOf"],[1,"mb-2","d-flex","flex-wrap","gap-2"],[1,"badge","rounded-pill","bg-primary-subtle","text-primary"],[1,"badge","rounded-pill","bg-success-subtle","text-success"],[1,"badge","rounded-pill","bg-secondary-subtle","text-secondary"],["class","alert alert-info",4,"ngIf"],[1,"table-responsive","shadow-sm","rounded","bg-white"],[1,"table","table-striped","table-hover","table-bordered","align-middle","mb-0","w-100"],[1,"table-light","position-sticky","top-0",2,"z-index","1"],[1,"sortable",3,"click"],[1,"arrow"],[1,"d-none","d-sm-table-cell"],[1,"d-none","d-md-table-cell"],[2,"width","160px"],[4,"ngFor","ngForOf"],[4,"ngIf"],[1,"d-flex","align-items-center","justify-content-between","mt-3"],[1,"text-muted"],[1,"btn-group"],[1,"btn","btn-outline-secondary",3,"click","disabled"],[3,"value"],[1,"alert","alert-info"],[1,"text-nowrap"],[1,"fw-semibold","d-flex","align-items-center","gap-2"],[1,"avatar","text-white","d-inline-flex","align-items-center","justify-content-center",3,"ngStyle"],[1,"text-muted","d-sm-none"],[1,"small","text-muted"],["class","d-none d-sm-table-cell",4,"ngIf"],[3,"sorted-col",4,"ngIf"],[1,"badge",3,"ngClass"],[1,"fas",3,"ngClass"],["class","btn-group btn-group-sm",4,"ngIf","ngIfElse"],["class","text-decoration-none",3,"href",4,"ngIf"],["class","text-muted",4,"ngIf"],[1,"text-decoration-none",3,"href"],[1,"fas","fa-phone","me-1","text-muted"],["type","text",1,"form-control","form-control-sm",3,"ngModelChange","ngModel"],[4,"ngIf","ngIfElse"],[1,"fas","fa-envelope","me-1","text-muted"],["title","Copiar",1,"btn","btn-link","btn-sm","py-0","ms-1",3,"click"],[1,"fas","fa-copy"],["type","email",1,"form-control","form-control-sm",3,"ngModelChange","ngModel"],[1,"btn-group","btn-group-sm"],[1,"btn","btn-outline-primary",3,"click"],[1,"fas","fa-pen","me-1"],[1,"btn","btn-success",3,"click"],[1,"btn","btn-outline-secondary",3,"click"],["colspan","6",1,"text-center","text-muted","py-4"]],template:function(o,n){1&o&&(t.j41(0,"div",2)(1,"div",3)(2,"h4",4),t.EFF(3,"Administraci\xf3n de Pacientes"),t.k0s(),t.j41(4,"div",5)(5,"div",6)(6,"span",7),t.nrm(7,"i",8),t.k0s(),t.j41(8,"input",9),t.mxI("ngModelChange",function(r){return t.DH7(n.search,r)||(n.search=r),r}),t.bIt("ngModelChange",function(){return n.applyFilters()}),t.k0s()(),t.j41(9,"div",10)(10,"select",11),t.mxI("ngModelChange",function(r){return t.DH7(n.statusFilter,r)||(n.statusFilter=r),r}),t.bIt("change",function(){return n.applyFilters()}),t.j41(11,"option",12),t.EFF(12,"Todos"),t.k0s(),t.j41(13,"option",13),t.EFF(14,"Activos"),t.k0s(),t.j41(15,"option",14),t.EFF(16,"Inactivos"),t.k0s()(),t.j41(17,"select",15),t.mxI("ngModelChange",function(r){return t.DH7(n.sortBy,r)||(n.sortBy=r),r}),t.bIt("change",function(){return n.applyFilters()}),t.j41(18,"option",16),t.EFF(19,"Ordenar por Apellidos"),t.k0s(),t.j41(20,"option",17),t.EFF(21,"Ordenar por Nombres"),t.k0s(),t.j41(22,"option",18),t.EFF(23,"Ordenar por DPI"),t.k0s(),t.j41(24,"option",19),t.EFF(25,"Ordenar por Correo"),t.k0s()(),t.j41(26,"select",20),t.mxI("ngModelChange",function(r){return t.DH7(n.sortDir,r)||(n.sortDir=r),r}),t.bIt("change",function(){return n.applyFilters()}),t.j41(27,"option",21),t.EFF(28,"Ascendente"),t.k0s(),t.j41(29,"option",22),t.EFF(30,"Descendente"),t.k0s()(),t.j41(31,"select",20),t.mxI("ngModelChange",function(r){return t.DH7(n.pageSize,r)||(n.pageSize=r),r}),t.bIt("change",function(){return n.changePageSize()}),t.DNE(32,C,2,2,"option",23),t.k0s()()()(),t.j41(33,"div",24)(34,"span",25),t.EFF(35),t.k0s(),t.j41(36,"span",26),t.EFF(37),t.k0s(),t.j41(38,"span",27),t.EFF(39),t.k0s()(),t.DNE(40,b,2,0,"div",28),t.j41(41,"div",29)(42,"table",30)(43,"thead",31)(44,"tr")(45,"th",32),t.bIt("click",function(){return n.setSort("dpi")}),t.EFF(46,"DPI "),t.j41(47,"span",33),t.EFF(48),t.k0s()(),t.j41(49,"th",32),t.bIt("click",function(){return n.setSort("apellidos")}),t.EFF(50,"Nombre "),t.j41(51,"span",33),t.EFF(52),t.k0s()(),t.j41(53,"th",34),t.EFF(54,"Tel\xe9fono"),t.k0s(),t.j41(55,"th",32),t.bIt("click",function(){return n.setSort("correo")}),t.EFF(56,"Correo "),t.j41(57,"span",33),t.EFF(58),t.k0s()(),t.j41(59,"th",35),t.EFF(60,"Estado"),t.k0s(),t.j41(61,"th",36),t.EFF(62,"Acciones"),t.k0s()()(),t.j41(63,"tbody"),t.DNE(64,j,25,20,"tr",37)(65,T,3,0,"tr",38),t.k0s()()(),t.j41(66,"div",39)(67,"div",40),t.EFF(68),t.k0s(),t.j41(69,"div",41)(70,"button",42),t.bIt("click",function(){return n.prevPage()}),t.EFF(71,"Anterior"),t.k0s(),t.j41(72,"button",42),t.bIt("click",function(){return n.nextPage()}),t.EFF(73,"Siguiente"),t.k0s()()()()),2&o&&(t.R7$(8),t.R50("ngModel",n.search),t.R7$(2),t.R50("ngModel",n.statusFilter),t.R7$(7),t.R50("ngModel",n.sortBy),t.R7$(9),t.R50("ngModel",n.sortDir),t.R7$(5),t.R50("ngModel",n.pageSize),t.R7$(),t.Y8G("ngForOf",n.pageSizeOptions),t.R7$(3),t.SpI("Total: ",n.totalCount),t.R7$(2),t.SpI("Activos: ",n.activeCount),t.R7$(2),t.SpI("Inactivos: ",n.inactiveCount),t.R7$(),t.Y8G("ngIf",n.loading),t.R7$(5),t.AVh("sorted-col",n.isSortedField("dpi")),t.R7$(3),t.JRh(n.sortArrow("dpi")),t.R7$(),t.AVh("sorted-col",n.isSortedField("apellidos")||n.isSortedField("nombres")),t.R7$(3),t.JRh(n.sortArrow("apellidos")),t.R7$(3),t.AVh("sorted-col",n.isSortedField("correo")),t.R7$(3),t.JRh(n.sortArrow("correo")),t.R7$(6),t.Y8G("ngForOf",n.paged),t.R7$(),t.Y8G("ngIf",!n.loading&&0===n.filtered.length),t.R7$(3),t.E5c("Mostrando ",(n.page-1)*n.pageSize+1," - ",n.min(n.page*n.pageSize,n.filtered.length)," de ",n.filtered.length),t.R7$(2),t.Y8G("disabled",n.page<=1),t.R7$(2),t.Y8G("disabled",n.page>=n.totalPages))},dependencies:[g.MD,g.YU,g.Sq,g.bT,g.B3,p.YN,p.xH,p.y7,p.me,p.wz,p.BC,p.vS],styles:[".container[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{font-weight:700;letter-spacing:.2px}.table[_ngcontent-%COMP%]{background:#fff}.table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{font-weight:600}.table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background-color:#f6f8ff}.badge[_ngcontent-%COMP%]{font-weight:500}.btn-group[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%] + .btn[_ngcontent-%COMP%]{margin-left:4px}.table-responsive[_ngcontent-%COMP%]{border:1px solid #eef0f5}.table-bordered[_ngcontent-%COMP%] > [_ngcontent-%COMP%]:not(caption) > *[_ngcontent-%COMP%]{border-width:1px 0}.table-bordered[_ngcontent-%COMP%] > [_ngcontent-%COMP%]:not(caption) > *[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{border-width:0 1px}.input-group[_ngcontent-%COMP%]   .input-group-text[_ngcontent-%COMP%]{background:#f8f9fc;border-right:0}.input-group[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]{border-left:0}.position-sticky[_ngcontent-%COMP%]{position:sticky}.sortable[_ngcontent-%COMP%]{cursor:pointer;-webkit-user-select:none;user-select:none}.sortable[_ngcontent-%COMP%]   .arrow[_ngcontent-%COMP%]{font-size:.7rem;opacity:.6;margin-left:.25rem}.avatar[_ngcontent-%COMP%]{width:28px;height:28px;border-radius:50%;font-size:.8rem}.sorted-col[_ngcontent-%COMP%]{background-color:#f2f6ff!important}.bg-primary-subtle[_ngcontent-%COMP%]{background-color:#e7f1ff}.text-primary[_ngcontent-%COMP%]{color:#0d6efd!important}.bg-success-subtle[_ngcontent-%COMP%]{background-color:#e9f7ef}.text-success[_ngcontent-%COMP%]{color:#198754!important}.bg-secondary-subtle[_ngcontent-%COMP%]{background-color:#f1f3f5}.text-secondary[_ngcontent-%COMP%]{color:#6c757d!important}"]})}return i})()}}]);
"use strict";(self.webpackChunkdermatologia_app=self.webpackChunkdermatologia_app||[]).push([[209],{2209:(R,_,l)=>{l.r(_),l.d(_,{SecretaryPatientsComponent:()=>I});var d=l(2200),g=l(9417),s=l(2615),t=l(3664),p=l(9885),u=l(9330),m=l(8397);function h(o,a){if(1&o&&(t.j41(0,"option",21),t.EFF(1),t.k0s()),2&o){const e=a.$implicit;t.Y8G("value",e),t.R7$(),t.SpI("",e," / p\xe1g")}}function f(o,a){1&o&&(t.j41(0,"div",22),t.EFF(1,"Cargando pacientes..."),t.k0s())}function C(o,a){if(1&o&&(t.j41(0,"td",12),t.EFF(1),t.k0s()),2&o){const e=t.XpG().$implicit;t.R7$(),t.JRh(e.Telefono||"\u2014")}}function P(o,a){if(1&o){const e=t.RV6();t.j41(0,"td",12)(1,"input",29),t.mxI("ngModelChange",function(n){s.eBV(e);const r=t.XpG(2);return t.DH7(r.editTelefono,n)||(r.editTelefono=n),s.Njj(n)}),t.k0s()()}if(2&o){const e=t.XpG(2);t.R7$(),t.R50("ngModel",e.editTelefono)}}function b(o,a){if(1&o&&(t.j41(0,"td"),t.EFF(1),t.k0s()),2&o){const e=t.XpG().$implicit;t.R7$(),t.JRh(e.Correo||"\u2014")}}function E(o,a){if(1&o){const e=t.RV6();t.j41(0,"td")(1,"input",30),t.mxI("ngModelChange",function(n){s.eBV(e);const r=t.XpG(2);return t.DH7(r.editCorreo,n)||(r.editCorreo=n),s.Njj(n)}),t.k0s()()}if(2&o){const e=t.XpG(2);t.R7$(),t.R50("ngModel",e.editCorreo)}}function S(o,a){if(1&o){const e=t.RV6();t.j41(0,"div",31)(1,"button",32),t.bIt("click",function(){s.eBV(e);const n=t.XpG().$implicit,r=t.XpG();return s.Njj(r.startEdit(n))}),t.EFF(2,"Editar"),t.k0s()()}}function F(o,a){if(1&o){const e=t.RV6();t.j41(0,"div",31)(1,"button",33),t.bIt("click",function(){s.eBV(e);const n=t.XpG(2);return s.Njj(n.saveEdit())}),t.EFF(2,"Guardar"),t.k0s(),t.j41(3,"button",34),t.bIt("click",function(){s.eBV(e);const n=t.XpG(2);return s.Njj(n.cancelEdit())}),t.EFF(4,"Cancelar"),t.k0s()()}}function M(o,a){if(1&o&&(t.j41(0,"tr")(1,"td",23),t.EFF(2),t.k0s(),t.j41(3,"td")(4,"div",24),t.EFF(5),t.k0s(),t.j41(6,"small",25),t.EFF(7),t.k0s()(),t.DNE(8,C,2,1,"td",26)(9,P,2,1,"td",26)(10,b,2,1,"td",16)(11,E,2,1,"td",16),t.j41(12,"td",13)(13,"span",27),t.EFF(14),t.k0s()(),t.j41(15,"td"),t.DNE(16,S,3,0,"div",28)(17,F,5,0,"ng-template",null,0,t.C5r),t.k0s()()),2&o){const e=a.$implicit,i=t.sdS(18),n=t.XpG();t.R7$(2),t.JRh(e.DPI),t.R7$(3),t.Lme("",e.Nombres," ",e.Apellidos),t.R7$(2),t.SpI("Tel: ",e.Telefono||"\u2014"),t.R7$(),t.Y8G("ngIf",n.editingDpi!==n.toStringVal(e.DPI)),t.R7$(),t.Y8G("ngIf",n.editingDpi===n.toStringVal(e.DPI)),t.R7$(),t.Y8G("ngIf",n.editingDpi!==n.toStringVal(e.DPI)),t.R7$(),t.Y8G("ngIf",n.editingDpi===n.toStringVal(e.DPI)),t.R7$(2),t.Y8G("ngClass","SI"===(e.Activo||"").toUpperCase()?"bg-success":"bg-secondary"),t.R7$(),t.SpI(" ","SI"===(e.Activo||"").toUpperCase()?"Activo":"Inactivo"," "),t.R7$(2),t.Y8G("ngIf",n.editingDpi!==n.toStringVal(e.DPI))("ngIfElse",i)}}function y(o,a){1&o&&(t.j41(0,"tr")(1,"td",35),t.EFF(2,"No se encontraron pacientes."),t.k0s()())}let I=(()=>{class o{userService;http;toast;patients=[];filtered=[];loading=!1;page=1;pageSize=10;pageSizeOptions=[5,10,20,50];totalPages=1;search="";editingDpi=null;editTelefono="";editCorreo="";constructor(e,i,n){this.userService=e,this.http=i,this.toast=n}ngOnInit(){this.loadPatients()}loadPatients(){this.loading=!0,this.userService.getPacientes(!0).subscribe({next:e=>{const i=Array.isArray(e)?e:e.data||e||[];this.patients=i,this.applyFilters(),this.loading=!1},error:e=>{console.error("Error cargando pacientes",e),this.loading=!1,this.toast.show("Error cargando pacientes","error")}})}applyFilters(){const e=(this.search||"").toLowerCase().trim();let i=[...this.patients];e&&(i=i.filter(n=>{const r=`${n.Nombres||""} ${n.Apellidos||""}`.toLowerCase(),c=(n.Correo||"").toLowerCase(),D=String(n.DPI||""),T=String(n.Telefono||"");return r.includes(e)||c.includes(e)||D.includes(e)||T.includes(e)})),this.filtered=i,this.page=1,this.recalcPages()}recalcPages(){this.totalPages=Math.max(1,Math.ceil(this.filtered.length/this.pageSize))}get paged(){const e=(this.page-1)*this.pageSize;return this.filtered.slice(e,e+this.pageSize)}prevPage(){this.page>1&&this.page--}nextPage(){this.page<this.totalPages&&this.page++}changePageSize(){this.page=1,this.recalcPages()}startEdit(e){this.editingDpi=String(e.DPI),this.editTelefono=e.Telefono||"",this.editCorreo=e.Correo||""}cancelEdit(){this.editingDpi=null,this.editTelefono="",this.editCorreo=""}saveEdit(){this.editingDpi&&this.userService.updateUserByType("pacientes",this.editingDpi,{Telefono:this.editTelefono,Correo:this.editCorreo}).subscribe({next:()=>{this.cancelEdit(),this.toast.show("Paciente actualizado"),this.loadPatients()},error:n=>{console.error("Error guardando paciente",n),this.toast.show("Error al guardar cambios","error")}})}toStringVal(e){try{return String(e??"")}catch{return""}}min(e,i){return Math.min(e,i)}static \u0275fac=function(i){return new(i||o)(t.rXU(p.D),t.rXU(u.Qq),t.rXU(m.f))};static \u0275cmp=t.VBU({type:o,selectors:[["app-secretary-patients"]],decls:36,vars:11,consts:[["editActions",""],[1,"container","py-3"],[1,"d-flex","align-items-center","justify-content-between","mb-3"],[1,"mb-0"],[1,"d-flex","align-items-center","gap-2"],["type","text","placeholder","Buscar por nombre, DPI, correo o tel\xe9fono",1,"form-control",2,"min-width","240px",3,"ngModelChange","ngModel"],[1,"form-select",2,"width","120px",3,"ngModelChange","change","ngModel"],[3,"value",4,"ngFor","ngForOf"],["class","alert alert-info",4,"ngIf"],[1,"table-responsive","shadow-sm","rounded"],[1,"table","table-hover","align-middle","mb-0"],[1,"table-light"],[1,"d-none","d-sm-table-cell"],[1,"d-none","d-md-table-cell"],[2,"width","160px"],[4,"ngFor","ngForOf"],[4,"ngIf"],[1,"d-flex","align-items-center","justify-content-between","mt-3"],[1,"text-muted"],[1,"btn-group"],[1,"btn","btn-outline-secondary",3,"click","disabled"],[3,"value"],[1,"alert","alert-info"],[1,"text-nowrap"],[1,"fw-semibold"],[1,"text-muted","d-sm-none"],["class","d-none d-sm-table-cell",4,"ngIf"],[1,"badge",3,"ngClass"],["class","btn-group btn-group-sm",4,"ngIf","ngIfElse"],["type","text",1,"form-control","form-control-sm",3,"ngModelChange","ngModel"],["type","email",1,"form-control","form-control-sm",3,"ngModelChange","ngModel"],[1,"btn-group","btn-group-sm"],[1,"btn","btn-outline-primary",3,"click"],[1,"btn","btn-success",3,"click"],[1,"btn","btn-outline-secondary",3,"click"],["colspan","6",1,"text-center","text-muted","py-4"]],template:function(i,n){1&i&&(t.j41(0,"div",1)(1,"div",2)(2,"h4",3),t.EFF(3,"Administraci\xf3n de Pacientes"),t.k0s(),t.j41(4,"div",4)(5,"input",5),t.mxI("ngModelChange",function(c){return t.DH7(n.search,c)||(n.search=c),c}),t.bIt("ngModelChange",function(){return n.applyFilters()}),t.k0s(),t.j41(6,"select",6),t.mxI("ngModelChange",function(c){return t.DH7(n.pageSize,c)||(n.pageSize=c),c}),t.bIt("change",function(){return n.changePageSize()}),t.DNE(7,h,2,2,"option",7),t.k0s()()(),t.DNE(8,f,2,0,"div",8),t.j41(9,"div",9)(10,"table",10)(11,"thead",11)(12,"tr")(13,"th"),t.EFF(14,"DPI"),t.k0s(),t.j41(15,"th"),t.EFF(16,"Nombre"),t.k0s(),t.j41(17,"th",12),t.EFF(18,"Tel\xe9fono"),t.k0s(),t.j41(19,"th"),t.EFF(20,"Correo"),t.k0s(),t.j41(21,"th",13),t.EFF(22,"Estado"),t.k0s(),t.j41(23,"th",14),t.EFF(24,"Acciones"),t.k0s()()(),t.j41(25,"tbody"),t.DNE(26,M,19,12,"tr",15)(27,y,3,0,"tr",16),t.k0s()()(),t.j41(28,"div",17)(29,"div",18),t.EFF(30),t.k0s(),t.j41(31,"div",19)(32,"button",20),t.bIt("click",function(){return n.prevPage()}),t.EFF(33,"Anterior"),t.k0s(),t.j41(34,"button",20),t.bIt("click",function(){return n.nextPage()}),t.EFF(35,"Siguiente"),t.k0s()()()()),2&i&&(t.R7$(5),t.R50("ngModel",n.search),t.R7$(),t.R50("ngModel",n.pageSize),t.R7$(),t.Y8G("ngForOf",n.pageSizeOptions),t.R7$(),t.Y8G("ngIf",n.loading),t.R7$(18),t.Y8G("ngForOf",n.paged),t.R7$(),t.Y8G("ngIf",!n.loading&&0===n.filtered.length),t.R7$(3),t.E5c("Mostrando ",(n.page-1)*n.pageSize+1," - ",n.min(n.page*n.pageSize,n.filtered.length)," de ",n.filtered.length),t.R7$(2),t.Y8G("disabled",n.page<=1),t.R7$(2),t.Y8G("disabled",n.page>=n.totalPages))},dependencies:[d.MD,d.YU,d.Sq,d.bT,g.YN,g.xH,g.y7,g.me,g.wz,g.BC,g.vS],styles:[".container[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{font-weight:600}.table[_ngcontent-%COMP%]{background:#fff}.table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{font-weight:600}.table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background-color:#fafbff}.badge[_ngcontent-%COMP%]{font-weight:500}.btn-group[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%] + .btn[_ngcontent-%COMP%]{margin-left:4px}"]})}return o})()}}]);
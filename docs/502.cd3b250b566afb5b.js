"use strict";(self.webpackChunkdermatologia_app=self.webpackChunkdermatologia_app||[]).push([[502],{3121:(w,h,c)=>{c.r(h),c.d(h,{SecretaryDashboardComponent:()=>y});var p=c(2200),d=c(9417),g=c(2615),e=c(3664),u=c(547),_=c(8397),b=c(9330);const C=(o,m)=>({"text-success":o,"text-danger":m});function v(o,m){1&o&&(e.j41(0,"div",6),e.EFF(1,"Cargando citas..."),e.k0s())}function M(o,m){if(1&o){const t=e.RV6();e.j41(0,"div")(1,"div",31),e.bIt("click",function(){const n=g.eBV(t).$implicit,s=e.XpG();return g.Njj(s.isSelectable(n)?s.selectAppointment(n.idCitas||n.id):null)}),e.j41(2,"div",32)(3,"div")(4,"strong"),e.EFF(5),e.nI1(6,"date"),e.k0s(),e.EFF(7),e.nI1(8,"slice"),e.k0s(),e.j41(9,"div",7),e.EFF(10),e.k0s(),e.j41(11,"div",33)(12,"span",34),e.EFF(13),e.k0s()()(),e.j41(14,"div",35)(15,"input",36),e.bIt("change",function(){const n=g.eBV(t).$implicit,s=e.XpG();return g.Njj(s.selectAppointment(n.idCitas||n.id))}),e.k0s()()()()}if(2&o){const t=m.$implicit,i=e.XpG();e.R7$(),e.AVh("disabled",!i.isSelectable(t)),e.R7$(4),e.JRh(e.i5U(6,9,t.fecha,"dd/MM/yyyy")||t.fecha),e.R7$(2),e.SpI(" - ",e.brH(8,12,t.hora||t.time,0,5)),e.R7$(3),e.Lme("Paciente: ",i.displayPatientName(t)," \u2022 M\xe9dico: ",i.displayDoctorName(t)),e.R7$(3),e.JRh(t.especialidadNombre||t.especialidadInfo&&t.especialidadInfo.Nombre||""),e.R7$(2),e.Y8G("disabled",!i.isSelectable(t))("checked",i.selectedAppointmentId===(t.idCitas||t.id))}}function P(o,m){if(1&o&&(e.j41(0,"option",37),e.EFF(1),e.k0s()),2&o){const t=m.$implicit;e.Y8G("value",t),e.R7$(),e.JRh(t)}}function O(o,m){if(1&o&&(e.j41(0,"div",38),e.EFF(1,"Estado: "),e.j41(2,"strong",39),e.EFF(3),e.k0s()()),2&o){const t=e.XpG();e.R7$(2),e.Y8G("ngClass",e.l_i(2,C,t.available,!t.available)),e.R7$(),e.JRh(t.available?"Disponible":"Ocupado")}}let y=(()=>{class o{appointmentService;toast;http;appointments=[];loading=!1;page=1;limit=25;dateFilter=null;statusFilter=null;timeString="";dateString="";use24Hour=!0;_clockInterval=null;selectedAppointmentId=null;selectedAppointment=null;newDate="";newTime="";availabilityChecked=!1;available=!1;allTimes=["09:00","09:30","10:00","10:30","11:00","11:30","12:00","12:30","13:00","15:00","15:30","16:00","16:30","17:00","17:30","18:00"];availableTimes=[];debugResp=null;showDebug=!1;missionText="";visionText="";constructor(t,i,n){this.appointmentService=t,this.toast=i,this.http=n}ngOnInit(){this.loadAppointments(),this.loadClockPreference(),this.startClock(),this.loadMissionVision()}loadMissionVision(){try{this.http.get("/api/settings/mission").subscribe({next:t=>{this.missionText=t&&t.value?t.value:""},error:t=>{console.error("Error loading mission for secretary dashboard",t),this.missionText=""}})}catch(t){console.warn(t)}try{this.http.get("/api/settings/vision").subscribe({next:t=>{this.visionText=t&&t.value?t.value:""},error:t=>{console.error("Error loading vision for secretary dashboard",t),this.visionText=""}})}catch(t){console.warn(t)}}ngOnDestroy(){this._clockInterval&&(clearInterval(this._clockInterval),this._clockInterval=null)}startClock(){const t=()=>{const i=new Date;this.timeString=i.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!this.use24Hour}),this.dateString=i.toLocaleDateString([],{weekday:"long",year:"numeric",month:"long",day:"numeric"})};t(),this._clockInterval=setInterval(t,1e3)}clockPrefKey(){return"clockFormat:secretaria"}loadClockPreference(){try{this.use24Hour="12"!==localStorage.getItem(this.clockPrefKey())}catch{}}loadAppointments(){this.loading=!0,this.appointmentService.getCitasPaged(this.page,this.limit,this.dateFilter||void 0,this.statusFilter||void 0).subscribe({next:t=>{console.log("[SecretaryDashboard] raw response from getCitasPaged:",t),this.debugResp=t;const i=Array.isArray(t)?t:t&&t.data?t.data:t;this.appointments=(i||[]).filter(n=>this.isSelectable(n)),console.log("[SecretaryDashboard] filtered appointments:",this.appointments),this.loading=!1},error:t=>{console.error("Error loading citas paged",t),this.toast.show("Error cargando citas"),this.loading=!1}})}confirm(t){this.appointmentService.confirmAppointment(t).subscribe({next:()=>{this.toast.show("Cita confirmada"),this.loadAppointments()},error:i=>{this.toast.show("Error confirmando cita"),console.error(i)}})}cancel(t){this.appointmentService.cancelAppointment(t).subscribe({next:()=>{this.toast.show("Cita cancelada"),this.loadAppointments()},error:i=>{this.toast.show("Error cancelando cita"),console.error(i)}})}selectAppointment(t){if(this.selectedAppointmentId=t,this.selectedAppointment=this.appointments.find(i=>String(i.idCitas||i.id)===String(t))||null,this.availabilityChecked=!1,this.available=!1,this.selectedAppointment){let i=this.selectedAppointment.fecha||this.selectedAppointment.Fecha||this.selectedAppointment.date;i&&i.length>10&&(i=i.slice(0,10)),this.newDate=i||"",this.newTime=(this.selectedAppointment.hora||this.selectedAppointment.Hora||this.selectedAppointment.time||"").slice(0,5)||"";const n=this.getDoctorIdFromAppointment(this.selectedAppointment);console.log("[SecretaryDashboard] selectAppointment selected",{id:t,doctorId:n,newDate:this.newDate,newTime:this.newTime,selectedAppointment:this.selectedAppointment}),this.updateAvailableTimes(n,this.newDate)}}getDoctorIdFromAppointment(t){if(!t)return null;const i=[t.Profesional_Responsable,t.profesional_Responsable,t.profesionalResponsable,t.profesional_responsable,t.doctorId,t.doctor_id,t.medicoId,t.medico,t.doctor&&(t.doctor.id||t.doctor._id||t.doctor.userId)];for(const n of i)if(null!=n&&""!==n)return n;return null}displayPatientName(t){if(!t)return"";const i=t.pacienteNombres||t.pacienteNombre||t.patientName||t.paciente&&t.paciente.nombres,n=t.pacienteApellidos||t.paciente&&t.paciente.apellidos||t.pacienteInfo&&t.pacienteInfo.apellidos;return i||n?((i||"")+" "+(n||"")).trim():t.paciente&&(t.paciente.nombres||t.paciente.name||t.paciente.fullName)||t.paciente||""}displayDoctorName(t){if(!t)return"";const i=t.doctorNombres||t.doctorNombre||t.doctorName||t.doctor&&t.doctor.nombres,n=t.doctorApellidos||t.doctor&&t.doctor.apellidos||t.doctorInfo&&t.doctorInfo.apellidos;return i||n?((i||"")+" "+(n||"")).trim():t.medico&&(t.medico.nombres||t.medico.name||t.medico.fullName)||t.medico||""}isSelectable(t){if(!t)return!1;const i=t.Confirmado||t.confirmado||t.estado||t.Estado||t.status||t.Status;if(null==i)return!1;const n=String(i).toLowerCase();return!n.includes("cancel")&&(n.includes("pendient")||n.includes("confirm")||"si"===n||"s\xed"===n||"true"===n||"1"===n)}checkAvailability(){}onTimeChange(){if(!this.selectedAppointment||!this.newDate||!this.newTime)return this.availabilityChecked=!1,void(this.available=!1);const t=this.selectedAppointment,i=this.getDoctorIdFromAppointment(t);if(console.log("[SecretaryDashboard] onTimeChange",{doctorId:i,date:this.newDate,time:this.newTime,availableTimes:this.availableTimes}),!i)return this.availabilityChecked=!0,void(this.available=!1);if(this.availableTimes&&this.availableTimes.length>0){const n=this.availableTimes.includes(this.newTime)||this.newTime===(t.hora||t.Hora||t.time);return this.availabilityChecked=!0,void(this.available=!!n)}this.appointmentService.checkDoctorAvailability(i,this.newDate,this.newTime).subscribe({next:n=>{this.availabilityChecked=!0,this.available=!!n},error:n=>{console.error(n),this.availabilityChecked=!0,this.available=!1}})}reschedule(){this.selectedAppointmentId&&this.newDate&&this.newTime?this.availabilityChecked&&this.available?this.appointmentService.rescheduleAppointment(this.selectedAppointmentId,this.newDate,this.newTime).subscribe({next:()=>{this.toast.show("Cita reprogramada"),this.loadAppointments(),this.selectedAppointmentId=null,this.newDate="",this.newTime="",this.availabilityChecked=!1,this.available=!1},error:t=>{console.error(t),this.toast.show("Error reprogramando cita")}}):this.toast.show("Verifica disponibilidad antes de reprogramar"):this.toast.show("Selecciona una cita y la nueva fecha/hora")}updateAvailableTimes(t,i){t&&i?this.appointmentService.getCitasPorDoctor(t).subscribe({next:n=>{const l=(n.citas||n||[]).filter(a=>{let r=a.Fecha||a.fecha||a.date;r&&r.length>10&&(r=r.slice(0,10));const f=a.Confirmado||a.confirmado||a.Estado||a.estado||a.status||"",k="cancelada"===String(f).toLowerCase()||"cancelado"===String(f).toLowerCase();return r===i&&!k}).map(a=>{let r=a.Hora||a.hora||a.time;return r&&r.length>=5&&(r=r.slice(0,5)),r});this.availableTimes=this.allTimes.filter(a=>!l.includes(a)),console.log("[SecretaryDashboard] updateAvailableTimes",{doctorId:t,date:i,ocupadas:l,availableTimes:this.availableTimes})},error:n=>{console.error("Error obteniendo citas por doctor",n),this.availableTimes=[...this.allTimes]}}):this.availableTimes=[...this.allTimes]}prevPage(){this.page>1&&(this.page--,this.loadAppointments())}nextPage(){this.page++,this.loadAppointments()}static \u0275fac=function(i){return new(i||o)(e.rXU(u.h),e.rXU(_.f),e.rXU(b.Qq))};static \u0275cmp=e.VBU({type:o,selectors:[["app-secretary-dashboard"]],decls:56,vars:10,consts:[[1,"secretary-dashboard","container","py-3"],[1,"patient-hero","d-flex","flex-column","align-items-center","justify-content-center","py-3","mb-3"],[1,"hero-clock","w-100","d-flex","justify-content-center"],[1,"clock-wrapper","d-flex","align-items-center","flex-column","flex-sm-row"],[1,"clock-time"],[1,"clock-date","mt-2","mt-sm-0","ms-sm-3"],[1,"mb-3"],[1,"small","text-muted"],["class","mb-3",4,"ngIf"],[1,"appointments-list","mb-3"],[4,"ngFor","ngForOf"],[1,"reprogram-controls","mb-4"],[1,"row","g-2","align-items-center"],[1,"col-auto"],[1,"form-label"],["type","date",1,"form-control",3,"ngModelChange","change","ngModel"],[1,"form-select",3,"ngModelChange","change","ngModel"],["value",""],[3,"value",4,"ngFor","ngForOf"],[1,"col-auto","d-flex","align-items-end"],[1,"btn","btn-primary",3,"click"],[1,"col-12","mt-2"],["class","small",4,"ngIf"],[1,"pagination-controls","mt-3"],[1,"btn","btn-outline-secondary",3,"click"],[1,"mission-vision","row","g-3","mt-4"],[1,"col-md-6","mb-3"],[1,"card","p-3"],[1,"card-header","pb-2"],[1,"card-body","pt-1"],[1,"mb-0"],[1,"appointment-item","p-2","mb-2","d-flex","align-items-center","justify-content-between",3,"click"],[1,"appointment-info"],[1,"mt-1"],[1,"badge","specialidad-badge"],[1,"form-check"],["type","radio","name","selectedApt",1,"form-check-input",3,"change","disabled","checked"],[3,"value"],[1,"small"],[3,"ngClass"]],template:function(i,n){1&i&&(e.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4),e.EFF(5),e.k0s(),e.j41(6,"div",5),e.EFF(7),e.k0s()()()(),e.j41(8,"div",6)(9,"h4"),e.EFF(10,"Reprogramar Cita"),e.k0s(),e.j41(11,"div",7),e.EFF(12,"Selecciona una cita (estado pendiente o confirmada) y elige nueva fecha y hora."),e.k0s()(),e.DNE(13,v,2,0,"div",8),e.j41(14,"div",9),e.DNE(15,M,16,16,"div",10),e.k0s(),e.j41(16,"div",11)(17,"div",12)(18,"div",13)(19,"label",14),e.EFF(20,"Nueva fecha"),e.k0s(),e.j41(21,"input",15),e.mxI("ngModelChange",function(l){return e.DH7(n.newDate,l)||(n.newDate=l),l}),e.bIt("change",function(){return n.selectedAppointment&&n.updateAvailableTimes(n.getDoctorIdFromAppointment(n.selectedAppointment),n.newDate)}),e.k0s()(),e.j41(22,"div",13)(23,"label",14),e.EFF(24,"Nuevo horario"),e.k0s(),e.j41(25,"select",16),e.mxI("ngModelChange",function(l){return e.DH7(n.newTime,l)||(n.newTime=l),l}),e.bIt("change",function(){return n.onTimeChange()}),e.j41(26,"option",17),e.EFF(27,"-- Selecciona --"),e.k0s(),e.DNE(28,P,2,2,"option",18),e.k0s()(),e.j41(29,"div",19)(30,"button",20),e.bIt("click",function(){return n.reschedule()}),e.EFF(31,"Reprogramar"),e.k0s()(),e.j41(32,"div",21),e.DNE(33,O,4,5,"div",22),e.k0s()()(),e.j41(34,"div",23)(35,"button",24),e.bIt("click",function(){return n.prevPage()}),e.EFF(36,"Anterior"),e.k0s(),e.j41(37,"button",24),e.bIt("click",function(){return n.nextPage()}),e.EFF(38,"Siguiente"),e.k0s()(),e.j41(39,"div",25)(40,"div",26)(41,"div",27)(42,"div",28)(43,"strong"),e.EFF(44,"Misi\xf3n"),e.k0s()(),e.j41(45,"div",29)(46,"p",30),e.EFF(47),e.k0s()()()(),e.j41(48,"div",26)(49,"div",27)(50,"div",28)(51,"strong"),e.EFF(52,"Visi\xf3n"),e.k0s()(),e.j41(53,"div",29)(54,"p",30),e.EFF(55),e.k0s()()()()()()),2&i&&(e.R7$(5),e.JRh(n.timeString),e.R7$(2),e.JRh(n.dateString),e.R7$(6),e.Y8G("ngIf",n.loading),e.R7$(2),e.Y8G("ngForOf",n.appointments),e.R7$(6),e.R50("ngModel",n.newDate),e.R7$(4),e.R50("ngModel",n.newTime),e.R7$(3),e.Y8G("ngForOf",n.availableTimes),e.R7$(5),e.Y8G("ngIf",n.availabilityChecked),e.R7$(14),e.JRh(n.missionText||"No definida"),e.R7$(8),e.JRh(n.visionText||"No definida"))},dependencies:[p.MD,p.YU,p.Sq,p.bT,d.YN,d.xH,d.y7,d.me,d.wz,d.BC,d.vS,p.P9,p.vh],styles:[".secretary-dashboard[_ngcontent-%COMP%]{padding:0 1rem}.secretary-dashboard[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 .5rem}.secretary-dashboard[_ngcontent-%COMP%]   .filters[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .secretary-dashboard[_ngcontent-%COMP%]   .filters[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{min-width:160px}.secretary-dashboard[_ngcontent-%COMP%]   .table[_ngcontent-%COMP%]{background:#fff}.secretary-dashboard[_ngcontent-%COMP%]   .btn-sm[_ngcontent-%COMP%]{padding:.4rem .9rem;font-size:.95rem}.patient-hero[_ngcontent-%COMP%]{gap:1.5rem;display:flex;align-items:center;justify-content:center;padding:1.25rem;background:linear-gradient(90deg,#45b6650f,#53c06f08);border-radius:12px}.clock-wrapper[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1.2rem}.clock-time[_ngcontent-%COMP%]{font-size:2.6rem;line-height:1;font-weight:900;color:var(--brand-700);text-shadow:0 2px 6px rgba(0,0,0,.06)}.clock-date[_ngcontent-%COMP%]{font-size:1rem;color:#374151;opacity:.95}.appointments-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.85rem}.appointments-list[_ngcontent-%COMP%]   .appointment-item[_ngcontent-%COMP%]{background:#fff;border-radius:10px;box-shadow:0 8px 24px #0206170f;padding:.9rem 1rem;display:flex;align-items:center;justify-content:space-between;gap:1rem}.appointments-list[_ngcontent-%COMP%]   .appointment-item[_ngcontent-%COMP%]   .appointment-info[_ngcontent-%COMP%]{min-width:240px}.appointments-list[_ngcontent-%COMP%]   .appointment-item[_ngcontent-%COMP%]   .appointment-meta[_ngcontent-%COMP%]{font-size:.98rem;color:#374151}.appointments-list[_ngcontent-%COMP%]   .appointment-item[_ngcontent-%COMP%]   .small[_ngcontent-%COMP%]{font-size:.95rem}.appointments-list[_ngcontent-%COMP%]   .appointment-item.disabled[_ngcontent-%COMP%]{opacity:.55}.appointment-actions[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.6rem}.appointment-actions[_ngcontent-%COMP%]   .form-check-input[_ngcontent-%COMP%]{transform:scale(1.15);margin-right:.45rem}.specialidad-badge[_ngcontent-%COMP%]{display:inline-block;background:#6366f114;color:#4f46e5;border:1px solid rgba(99,102,241,.18);padding:.18rem .5rem;border-radius:999px;font-size:.82rem;font-weight:600}.mission-vision[_ngcontent-%COMP%]{margin-top:1.5rem}.mission-vision[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]{min-height:150px;padding:1rem;box-shadow:0 6px 18px #0206170a}.mission-vision[_ngcontent-%COMP%]   .col-md-6[_ngcontent-%COMP%]{padding-left:.75rem;padding-right:.75rem}.mission-vision[_ngcontent-%COMP%]   .col-md-6[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]{margin-bottom:1.25rem}@media (max-width: 768px){.mission-vision[_ngcontent-%COMP%]   .col-md-6[_ngcontent-%COMP%]{padding-left:.5rem;padding-right:.5rem}.mission-vision[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]{min-height:120px}}.reprogram-controls[_ngcontent-%COMP%]   .form-label[_ngcontent-%COMP%]{font-size:.95rem;font-weight:600}.reprogram-controls[_ngcontent-%COMP%]   input[type=date][_ngcontent-%COMP%], .reprogram-controls[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{min-width:220px;padding:.55rem .7rem;font-size:1.02rem;border-radius:6px}.reprogram-controls[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{padding:.6rem 1rem;font-size:1.02rem}.d-flex.gap-2[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{padding:.45rem .85rem}.reprogram-controls[_ngcontent-%COMP%]   .row[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;align-items:center;gap:1rem!important;margin-top:.4rem}.reprogram-controls[_ngcontent-%COMP%]   .col-auto[_ngcontent-%COMP%]{margin-right:0}.reprogram-controls[_ngcontent-%COMP%]   .col-auto[_ngcontent-%COMP%]:last-child{margin-right:0}.reprogram-controls[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{margin-left:.4rem}.pagination-controls[_ngcontent-%COMP%]{display:flex;gap:1rem;margin-top:1.2rem}.pagination-controls[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{min-width:120px}@media (max-width: 576px){.reprogram-controls[_ngcontent-%COMP%]   .col-auto[_ngcontent-%COMP%]{width:100%;margin-right:0}.reprogram-controls[_ngcontent-%COMP%]{row-gap:.6rem}.pagination-controls[_ngcontent-%COMP%]{justify-content:space-between}}.reprogram-controls[_ngcontent-%COMP%]   .form-label[_ngcontent-%COMP%]{font-size:.85rem}"]})}return o})()}}]);
"use strict";(self.webpackChunkdermatologia_app=self.webpackChunkdermatologia_app||[]).push([[209],{2209:(T,u,g)=>{g.r(u),g.d(u,{SecretaryPatientsComponent:()=>D});var p=g(2200),d=g(9417),c=g(2615),e=g(3664),m=g(9885),f=g(9330),h=g(8397);function C(r,l){if(1&r&&(e.j41(0,"option",36),e.EFF(1),e.k0s()),2&r){const t=l.$implicit;e.Y8G("value",t),e.R7$(),e.SpI("",t," / p\xe1g")}}function P(r,l){1&r&&(e.j41(0,"div",37),e.EFF(1,"Cargando pacientes..."),e.k0s())}function F(r,l){if(1&r&&(e.j41(0,"td",27),e.EFF(1),e.k0s()),2&r){const t=e.XpG().$implicit;e.R7$(),e.JRh(t.Telefono||"\u2014")}}function b(r,l){if(1&r){const t=e.RV6();e.j41(0,"td",27)(1,"input",45),e.mxI("ngModelChange",function(n){c.eBV(t);const s=e.XpG(2);return e.DH7(s.editTelefono,n)||(s.editTelefono=n),c.Njj(n)}),e.k0s()()}if(2&r){const t=e.XpG(2);e.R7$(),e.R50("ngModel",t.editTelefono)}}function E(r,l){if(1&r&&(e.j41(0,"td"),e.EFF(1),e.k0s()),2&r){const t=e.XpG().$implicit;e.R7$(),e.JRh(t.Correo||"\u2014")}}function y(r,l){if(1&r){const t=e.RV6();e.j41(0,"td")(1,"input",46),e.mxI("ngModelChange",function(n){c.eBV(t);const s=e.XpG(2);return e.DH7(s.editCorreo,n)||(s.editCorreo=n),c.Njj(n)}),e.k0s()()}if(2&r){const t=e.XpG(2);e.R7$(),e.R50("ngModel",t.editCorreo)}}function M(r,l){if(1&r){const t=e.RV6();e.j41(0,"div",47)(1,"button",48),e.bIt("click",function(){c.eBV(t);const n=e.XpG().$implicit,s=e.XpG();return c.Njj(s.startEdit(n))}),e.EFF(2,"Editar"),e.k0s()()}}function S(r,l){if(1&r){const t=e.RV6();e.j41(0,"div",47)(1,"button",49),e.bIt("click",function(){c.eBV(t);const n=e.XpG(2);return c.Njj(n.saveEdit())}),e.EFF(2,"Guardar"),e.k0s(),e.j41(3,"button",50),e.bIt("click",function(){c.eBV(t);const n=e.XpG(2);return c.Njj(n.cancelEdit())}),e.EFF(4,"Cancelar"),e.k0s()()}}function I(r,l){if(1&r&&(e.j41(0,"tr")(1,"td",38),e.EFF(2),e.k0s(),e.j41(3,"td")(4,"div",39)(5,"div",40),e.EFF(6),e.k0s(),e.j41(7,"span"),e.EFF(8),e.k0s()(),e.j41(9,"small",41),e.EFF(10),e.k0s()(),e.DNE(11,F,2,1,"td",42)(12,b,2,1,"td",42)(13,E,2,1,"td",31)(14,y,2,1,"td",31),e.j41(15,"td",28)(16,"span",43),e.EFF(17),e.k0s()(),e.j41(18,"td"),e.DNE(19,M,3,0,"div",44)(20,S,5,0,"ng-template",null,0,e.C5r),e.k0s()()),2&r){const t=l.$implicit,i=e.sdS(21),n=e.XpG();e.R7$(2),e.JRh(t.DPI),e.R7$(4),e.Lme(" ",(t.Nombres||" ")[0]||" ","",(t.Apellidos||" ")[0]||" "," "),e.R7$(2),e.Lme("",t.Nombres," ",t.Apellidos),e.R7$(2),e.SpI("Tel: ",t.Telefono||"\u2014"),e.R7$(),e.Y8G("ngIf",n.editingDpi!==n.toStringVal(t.DPI)),e.R7$(),e.Y8G("ngIf",n.editingDpi===n.toStringVal(t.DPI)),e.R7$(),e.Y8G("ngIf",n.editingDpi!==n.toStringVal(t.DPI)),e.R7$(),e.Y8G("ngIf",n.editingDpi===n.toStringVal(t.DPI)),e.R7$(2),e.Y8G("ngClass","SI"===(t.Activo||"").toUpperCase()?"bg-success":"bg-secondary"),e.R7$(),e.SpI(" ","SI"===(t.Activo||"").toUpperCase()?"Activo":"Inactivo"," "),e.R7$(2),e.Y8G("ngIf",n.editingDpi!==n.toStringVal(t.DPI))("ngIfElse",i)}}function v(r,l){1&r&&(e.j41(0,"tr")(1,"td",51),e.EFF(2,"No se encontraron pacientes."),e.k0s()())}let D=(()=>{class r{userService;http;toast;patients=[];filtered=[];loading=!1;page=1;pageSize=10;pageSizeOptions=[5,10,20,50];totalPages=1;search="";sortBy="apellidos";sortDir="asc";statusFilter="todos";editingDpi=null;editTelefono="";editCorreo="";constructor(t,i,n){this.userService=t,this.http=i,this.toast=n}ngOnInit(){this.loadPatients()}loadPatients(){this.loading=!0,this.userService.getPacientes(!0).subscribe({next:t=>{const i=Array.isArray(t)?t:t.data||t||[];this.patients=(i||[]).map(n=>this.normalizePatient(n)),this.applyFilters(),this.loading=!1},error:t=>{console.error("Error cargando pacientes",t),this.loading=!1,this.toast.show("Error cargando pacientes","error")}})}applyFilters(){const t=(this.search||"").toLowerCase().trim();let i=[...this.patients];if("todos"!==this.statusFilter){const o="activos"===this.statusFilter;i=i.filter(a=>(a.Activo||"NO")===(o?"SI":"NO"))}t&&(i=i.filter(o=>{const a=`${o.Nombres||""} ${o.Apellidos||""}`.toLowerCase(),_=(o.Correo||"").toLowerCase(),j=String(o.DPI||""),k=String(o.Telefono||"");return a.includes(t)||_.includes(t)||j.includes(t)||k.includes(t)}));const n="asc"===this.sortDir?1:-1,s=o=>{switch(this.sortBy){case"nombres":return`${o.Nombres||""}`.toLowerCase();case"dpi":return String(o.DPI||"");case"correo":return`${o.Correo||""}`.toLowerCase();default:return`${o.Apellidos||""}`.toLowerCase()}};i.sort((o,a)=>s(o)>s(a)?1*n:s(o)<s(a)?-1*n:0),this.filtered=i,this.page=1,this.recalcPages()}recalcPages(){this.totalPages=Math.max(1,Math.ceil(this.filtered.length/this.pageSize))}get paged(){const t=(this.page-1)*this.pageSize;return this.filtered.slice(t,t+this.pageSize)}prevPage(){this.page>1&&this.page--}nextPage(){this.page<this.totalPages&&this.page++}changePageSize(){this.page=1,this.recalcPages()}startEdit(t){this.editingDpi=String(t.DPI),this.editTelefono=t.Telefono||"",this.editCorreo=t.Correo||""}cancelEdit(){this.editingDpi=null,this.editTelefono="",this.editCorreo=""}saveEdit(){this.editingDpi&&this.userService.updateUserByType("pacientes",this.editingDpi,{Telefono:this.editTelefono,Correo:this.editCorreo}).subscribe({next:()=>{this.cancelEdit(),this.toast.show("Paciente actualizado"),this.loadPatients()},error:n=>{console.error("Error guardando paciente",n),this.toast.show("Error al guardar cambios","error")}})}toStringVal(t){try{return String(t??"")}catch{return""}}min(t,i){return Math.min(t,i)}normalizePatient(t){const i=(a,_)=>typeof a<"u"&&null!==a&&""!==a?a:_,s=i(t.Activo,i(t.activo,"SI")),o=(()=>{const a=(""+s).toUpperCase();return"SI"===a||"S"===a||"TRUE"===a||"1"===a?"SI":"NO"})();return{...t,DPI:i(t.DPI,i(t.dpi,i(t.id,""))),Nombres:i(t.Nombres,t.nombres||""),Apellidos:i(t.Apellidos,t.apellidos||""),Telefono:i(t.Telefono,t.telefono||""),Correo:i(t.Correo,t.correo||""),Activo:o}}static \u0275fac=function(i){return new(i||r)(e.rXU(m.D),e.rXU(f.Qq),e.rXU(h.f))};static \u0275cmp=e.VBU({type:r,selectors:[["app-secretary-patients"]],decls:61,vars:14,consts:[["editActions",""],[1,"container","py-3"],[1,"d-flex","flex-column","flex-lg-row","align-items-lg-center","justify-content-between","gap-2","mb-3"],[1,"mb-0"],[1,"d-flex","flex-wrap","align-items-center","gap-2"],[1,"input-group",2,"min-width","280px"],[1,"input-group-text"],[1,"fas","fa-search"],["type","text","placeholder","Buscar por nombre, DPI, correo o tel\xe9fono",1,"form-control",3,"ngModelChange","ngModel"],[1,"d-flex","align-items-center","gap-2"],[1,"form-select",2,"width","160px",3,"ngModelChange","change","ngModel"],["value","todos"],["value","activos"],["value","inactivos"],[1,"form-select",2,"width","170px",3,"ngModelChange","change","ngModel"],["value","apellidos"],["value","nombres"],["value","dpi"],["value","correo"],[1,"form-select",2,"width","120px",3,"ngModelChange","change","ngModel"],["value","asc"],["value","desc"],[3,"value",4,"ngFor","ngForOf"],["class","alert alert-info",4,"ngIf"],[1,"table-responsive","shadow-sm","rounded"],[1,"table","table-striped","table-hover","align-middle","mb-0"],[1,"table-light","position-sticky","top-0",2,"z-index","1"],[1,"d-none","d-sm-table-cell"],[1,"d-none","d-md-table-cell"],[2,"width","160px"],[4,"ngFor","ngForOf"],[4,"ngIf"],[1,"d-flex","align-items-center","justify-content-between","mt-3"],[1,"text-muted"],[1,"btn-group"],[1,"btn","btn-outline-secondary",3,"click","disabled"],[3,"value"],[1,"alert","alert-info"],[1,"text-nowrap"],[1,"fw-semibold","d-flex","align-items-center","gap-2"],[1,"rounded-circle","bg-primary","text-white","d-inline-flex","align-items-center","justify-content-center",2,"width","28px","height","28px","font-size","0.8rem"],[1,"text-muted","d-sm-none"],["class","d-none d-sm-table-cell",4,"ngIf"],[1,"badge",3,"ngClass"],["class","btn-group btn-group-sm",4,"ngIf","ngIfElse"],["type","text",1,"form-control","form-control-sm",3,"ngModelChange","ngModel"],["type","email",1,"form-control","form-control-sm",3,"ngModelChange","ngModel"],[1,"btn-group","btn-group-sm"],[1,"btn","btn-outline-primary",3,"click"],[1,"btn","btn-success",3,"click"],[1,"btn","btn-outline-secondary",3,"click"],["colspan","6",1,"text-center","text-muted","py-4"]],template:function(i,n){1&i&&(e.j41(0,"div",1)(1,"div",2)(2,"h4",3),e.EFF(3,"Administraci\xf3n de Pacientes"),e.k0s(),e.j41(4,"div",4)(5,"div",5)(6,"span",6),e.nrm(7,"i",7),e.k0s(),e.j41(8,"input",8),e.mxI("ngModelChange",function(o){return e.DH7(n.search,o)||(n.search=o),o}),e.bIt("ngModelChange",function(){return n.applyFilters()}),e.k0s()(),e.j41(9,"div",9)(10,"select",10),e.mxI("ngModelChange",function(o){return e.DH7(n.statusFilter,o)||(n.statusFilter=o),o}),e.bIt("change",function(){return n.applyFilters()}),e.j41(11,"option",11),e.EFF(12,"Todos"),e.k0s(),e.j41(13,"option",12),e.EFF(14,"Activos"),e.k0s(),e.j41(15,"option",13),e.EFF(16,"Inactivos"),e.k0s()(),e.j41(17,"select",14),e.mxI("ngModelChange",function(o){return e.DH7(n.sortBy,o)||(n.sortBy=o),o}),e.bIt("change",function(){return n.applyFilters()}),e.j41(18,"option",15),e.EFF(19,"Ordenar por Apellidos"),e.k0s(),e.j41(20,"option",16),e.EFF(21,"Ordenar por Nombres"),e.k0s(),e.j41(22,"option",17),e.EFF(23,"Ordenar por DPI"),e.k0s(),e.j41(24,"option",18),e.EFF(25,"Ordenar por Correo"),e.k0s()(),e.j41(26,"select",19),e.mxI("ngModelChange",function(o){return e.DH7(n.sortDir,o)||(n.sortDir=o),o}),e.bIt("change",function(){return n.applyFilters()}),e.j41(27,"option",20),e.EFF(28,"Ascendente"),e.k0s(),e.j41(29,"option",21),e.EFF(30,"Descendente"),e.k0s()(),e.j41(31,"select",19),e.mxI("ngModelChange",function(o){return e.DH7(n.pageSize,o)||(n.pageSize=o),o}),e.bIt("change",function(){return n.changePageSize()}),e.DNE(32,C,2,2,"option",22),e.k0s()()()(),e.DNE(33,P,2,0,"div",23),e.j41(34,"div",24)(35,"table",25)(36,"thead",26)(37,"tr")(38,"th"),e.EFF(39,"DPI"),e.k0s(),e.j41(40,"th"),e.EFF(41,"Nombre"),e.k0s(),e.j41(42,"th",27),e.EFF(43,"Tel\xe9fono"),e.k0s(),e.j41(44,"th"),e.EFF(45,"Correo"),e.k0s(),e.j41(46,"th",28),e.EFF(47,"Estado"),e.k0s(),e.j41(48,"th",29),e.EFF(49,"Acciones"),e.k0s()()(),e.j41(50,"tbody"),e.DNE(51,I,22,14,"tr",30)(52,v,3,0,"tr",31),e.k0s()()(),e.j41(53,"div",32)(54,"div",33),e.EFF(55),e.k0s(),e.j41(56,"div",34)(57,"button",35),e.bIt("click",function(){return n.prevPage()}),e.EFF(58,"Anterior"),e.k0s(),e.j41(59,"button",35),e.bIt("click",function(){return n.nextPage()}),e.EFF(60,"Siguiente"),e.k0s()()()()),2&i&&(e.R7$(8),e.R50("ngModel",n.search),e.R7$(2),e.R50("ngModel",n.statusFilter),e.R7$(7),e.R50("ngModel",n.sortBy),e.R7$(9),e.R50("ngModel",n.sortDir),e.R7$(5),e.R50("ngModel",n.pageSize),e.R7$(),e.Y8G("ngForOf",n.pageSizeOptions),e.R7$(),e.Y8G("ngIf",n.loading),e.R7$(18),e.Y8G("ngForOf",n.paged),e.R7$(),e.Y8G("ngIf",!n.loading&&0===n.filtered.length),e.R7$(3),e.E5c("Mostrando ",(n.page-1)*n.pageSize+1," - ",n.min(n.page*n.pageSize,n.filtered.length)," de ",n.filtered.length),e.R7$(2),e.Y8G("disabled",n.page<=1),e.R7$(2),e.Y8G("disabled",n.page>=n.totalPages))},dependencies:[p.MD,p.YU,p.Sq,p.bT,d.YN,d.xH,d.y7,d.me,d.wz,d.BC,d.vS],styles:[".container[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{font-weight:700;letter-spacing:.2px}.table[_ngcontent-%COMP%]{background:#fff}.table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{font-weight:600}.table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background-color:#f6f8ff}.badge[_ngcontent-%COMP%]{font-weight:500}.btn-group[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%] + .btn[_ngcontent-%COMP%]{margin-left:4px}.table-responsive[_ngcontent-%COMP%]{border:1px solid #eef0f5}.input-group[_ngcontent-%COMP%]   .input-group-text[_ngcontent-%COMP%]{background:#f8f9fc;border-right:0}.input-group[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]{border-left:0}.position-sticky[_ngcontent-%COMP%]{position:sticky}"]})}return r})()}}]);
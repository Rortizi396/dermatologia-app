"use strict";(self.webpackChunkdermatologia_app=self.webpackChunkdermatologia_app||[]).push([[255],{2255:(A,_,d)=>{d.r(_),d.d(_,{DoctorDashboardComponent:()=>x});var C=d(2200),v=d(9417),o=d(3664),y=d(4796),M=d(547),D=d(8397),I=d(3488),O=d(9330);function E(g,F){1&g&&(o.j41(0,"div"),o.EFF(1,"Cargando..."),o.k0s())}function S(g,F){1&g&&(o.j41(0,"div",18),o.EFF(1,"No hay citas hoy."),o.k0s())}let x=(()=>{class g{auth;appointmentService;toast;router;http;timeString="";dateString="";use24Hour=!0;_clockInterval=null;_refreshInterval=null;missionText="";visionText="";doctorId=null;appointments=[];loading=!1;constructor(t,e,n,r,l){this.auth=t,this.appointmentService=e,this.toast=n,this.router=r,this.http=l}ngOnInit(){this.startClock(),this.loadUser(),this._refreshInterval=setInterval(()=>{this.loadTodayAppointments()},15e3),this.loadMissionVision()}loadMissionVision(){try{this.http.get("/api/settings/mission").subscribe({next:t=>{this.missionText=t&&t.value?t.value:""},error:t=>{console.error("Error loading mission for doctor dashboard",t),this.missionText=""}})}catch(t){console.warn(t)}try{this.http.get("/api/settings/vision").subscribe({next:t=>{this.visionText=t&&t.value?t.value:""},error:t=>{console.error("Error loading vision for doctor dashboard",t),this.visionText=""}})}catch(t){console.warn(t)}}ngOnDestroy(){this._clockInterval&&clearInterval(this._clockInterval),this._refreshInterval&&clearInterval(this._refreshInterval)}startClock(){const t=()=>{const e=new Date;this.timeString=e.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!this.use24Hour}),this.dateString=e.toLocaleDateString([],{weekday:"long",year:"numeric",month:"long",day:"numeric"})};t(),this._clockInterval=setInterval(t,1e3)}loadUser(){const t=this.auth.currentUserValue;t&&(this.doctorId=t?.id||t?.userId||t?._id||t?.doctorId||t?.usuarioId&&t.usuarioId.id||null,!this.doctorId&&t?.dpi&&(this.doctorId=t.dpi),this.loadTodayAppointments())}formatDateIso(t){return`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")}`}loadTodayAppointments(){this.loading=!0,console.log("[DoctorDashboard] loadTodayAppointments doctorId=",this.doctorId);const t=new Date,n=(this.formatDateIso(t),r=>{const l=Array.isArray(r)?r:r.citas||r.data||r;this.appointments=(l||[]).filter(s=>this.isSameDate(s.Fecha||s.fecha||s.date||"",t)).sort((s,c)=>(s.hora||s.Hora||s.time||"").localeCompare(c.hora||c.Hora||c.time||""))});this.doctorId?this.appointmentService.getCitasPorDoctor(this.doctorId).subscribe({next:r=>{if(console.log("[DoctorDashboard] getCitasPorDoctor resp=",r),n(r),this.appointments&&0!==this.appointments.length)this.loading=!1;else{console.log("[DoctorDashboard] no citas from getCitasPorDoctor, trying paged fallback by email/name");const l=this.auth.currentUserValue,s=this.getUserEmailCandidates(l),c=this.getUserNameCandidates(l);this.appointmentService.getCitasPaged(1,500).subscribe({next:a=>{console.log("[DoctorDashboard] fallback getCitasPaged resp length=",a&&a.data&&a.data.length||(Array.isArray(a)?a.length:0));const f=((Array.isArray(a)?a:a.data||a.citas||a)||[]).filter(i=>{if(!this.isSameDate(i.Fecha||i.fecha||i.date||"",t))return!1;const u=String(i.Profesional_Responsable||i.profesional_Responsable||i.profesional||i.profesionalId||"").toLowerCase(),w=String(i.profesionalEmail||i.doctorEmail||i.email||"").toLowerCase();if(s.some(h=>h&&u.includes(String(h).toLowerCase()))||s.some(h=>h&&w.includes(String(h).toLowerCase())))return!0;const R=String(i.doctorNombres||i.doctorNombre||i.doctorName||i.nombreProfesional||i.ProfesionalNombre||"").toLowerCase();if(c.some(h=>h&&R.includes(String(h).toLowerCase())))return!0;const P=String(i.Colegiado||i.colegiado||i.colegiadoId||i.colegiado_numero||"").toLowerCase(),b=l&&(l.colegiado||l.Colegiado||l.colegiadoNum||l.colegiado_numero)?String(l.colegiado||l.Colegiado||l.colegiadoNum||l.colegiado_numero).toLowerCase():null;return!(!b||!P||b!==P)});this.appointments=f.sort((i,u)=>(i.hora||i.Hora||i.time||"").localeCompare(u.hora||u.Hora||u.time||"")),console.log("[DoctorDashboard] fallback filtered appointments length=",this.appointments.length),this.loading=!1},error:a=>{console.error(a),this.toast.show("Error buscando citas en fallback"),this.loading=!1}})}},error:r=>{console.error(r),this.toast.show("Error cargando citas por doctor"),this.loading=!1}}):this.appointmentService.getCitasPaged(1,500).subscribe({next:r=>{console.log("[DoctorDashboard] getCitasPaged resp length=",r&&r.data&&r.data.length||(Array.isArray(r)?r.length:0));const l=this.getUserIdCandidates(this.auth.currentUserValue);console.log("[DoctorDashboard] user id candidates=",l);const c=((Array.isArray(r)?r:r.data||r.citas||r)||[]).filter(a=>{const p=a.Profesional_Responsable||a.profesional_Responsable||a.Profesional||a.profesional||a.profesionalResponsable||a.profesional_responsable||a.profesionalId||a.profesional;return l.some(f=>null!==f&&String(f)===String(p))&&this.isSameDate(a.Fecha||a.fecha||a.date||"",t)});this.appointments=c.sort((a,p)=>(a.hora||a.Hora||a.time||"").localeCompare(p.hora||p.Hora||p.time||"")),this.loading=!1},error:r=>{console.error(r),this.toast.show("Error cargando citas"),this.loading=!1}})}isSameDate(t,e){if(!t)return!1;try{const n=new Date(t);return n.getFullYear()===e.getFullYear()&&n.getMonth()===e.getMonth()&&n.getDate()===e.getDate()}catch{return!1}}getUserIdCandidates(t){if(!t)return[null];const e=[];return t.id&&e.push(t.id),t.dpi&&e.push(t.dpi),t.Profesional_Responsable&&e.push(t.Profesional_Responsable),t.profesional_Responsable&&e.push(t.profesional_Responsable),t.usuarioId&&t.usuarioId.id&&e.push(t.usuarioId.id),t.userId&&e.push(t.userId),Array.from(new Set(e.filter(n=>null!=n)))}getUserEmailCandidates(t){if(!t)return[];const e=[];return t.email&&e.push(String(t.email)),t.correo&&e.push(String(t.correo)),t.usuario&&t.usuario.email&&e.push(String(t.usuario.email)),Array.from(new Set(e.filter(n=>!!n)))}getUserNameCandidates(t){if(!t)return[];const e=[];return t.nombre&&e.push(String(t.nombre)),t.nombres&&e.push(String(t.nombres)),t.fullName&&e.push(String(t.fullName)),t.usuario&&(t.usuario.nombre||t.usuario.nombres)&&e.push(String(t.usuario.nombre||t.usuario.nombres)),Array.from(new Set(e.filter(n=>!!n)))}displayPatientName(t){return t?((t.pacienteNombres||t.pacienteNombre||t.pacienteInfo&&t.pacienteInfo.nombres||t.Paciente||t.paciente||"")+" "+(t.pacienteApellidos||t.pacienteInfo&&t.pacienteInfo.apellidos||"")).trim():""}displayTime(t){const e=t.hora||t.Hora||t.time||"";return e?e.slice(0,5):""}displayDate(t){if(!t)return"";const e=t.fecha||t.Fecha||t.date;if(!e)return"";const n=new Date(e);return isNaN(n.getTime())?e:n.toLocaleDateString()}getProfesionalResponsable(t){return t.Profesional_Responsable||t.profesional_Responsable||t.profesional||t.profesionalId||t.profesionalResponsable}static \u0275fac=function(e){return new(e||g)(o.rXU(y.u),o.rXU(M.h),o.rXU(D.f),o.rXU(I.Ix),o.rXU(O.Qq))};static \u0275cmp=o.VBU({type:g,selectors:[["app-doctor-dashboard"]],decls:36,vars:7,consts:[[1,"doctor-dashboard","container","py-3"],[1,"hero","d-flex","justify-content-center","mb-3"],[1,"clock-large","text-center"],[1,"time"],[1,"date","small","text-muted"],[4,"ngIf"],["class","text-muted",4,"ngIf"],[1,"appointments-summary","mt-4","d-flex","justify-content-center"],[1,"card","summary-card","p-4","text-center"],[1,"summary-title","mb-2"],[1,"summary-count","display-1","mb-2"],[1,"summary-sub","small","text-muted"],[1,"mission-vision","row","g-3","mt-4"],[1,"col-md-6","mb-3"],[1,"card","p-3"],[1,"card-header","pb-2"],[1,"card-body","pt-1"],[1,"mb-0"],[1,"text-muted"]],template:function(e,n){1&e&&(o.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3),o.EFF(4),o.k0s(),o.j41(5,"div",4),o.EFF(6),o.k0s()()(),o.j41(7,"h4"),o.EFF(8,"Agenda de Hoy"),o.k0s(),o.DNE(9,E,2,0,"div",5)(10,S,2,0,"div",6),o.j41(11,"div",7)(12,"div",8)(13,"div",9),o.EFF(14,"Citas programadas hoy"),o.k0s(),o.j41(15,"div",10),o.EFF(16),o.k0s(),o.j41(17,"div",11),o.EFF(18,"(Total de citas para la fecha de hoy)"),o.k0s()()(),o.j41(19,"div",12)(20,"div",13)(21,"div",14)(22,"div",15)(23,"strong"),o.EFF(24,"Misi\xf3n"),o.k0s()(),o.j41(25,"div",16)(26,"p",17),o.EFF(27),o.k0s()()()(),o.j41(28,"div",13)(29,"div",14)(30,"div",15)(31,"strong"),o.EFF(32,"Visi\xf3n"),o.k0s()(),o.j41(33,"div",16)(34,"p",17),o.EFF(35),o.k0s()()()()()()),2&e&&(o.R7$(4),o.JRh(n.timeString),o.R7$(2),o.JRh(n.dateString),o.R7$(3),o.Y8G("ngIf",n.loading),o.R7$(),o.Y8G("ngIf",!n.loading&&0===n.appointments.length),o.R7$(6),o.JRh(n.appointments.length),o.R7$(11),o.JRh(n.missionText||"No definida"),o.R7$(8),o.JRh(n.visionText||"No definida"))},dependencies:[C.MD,C.bT,v.YN],styles:[".doctor-dashboard[_ngcontent-%COMP%]   .clock-large[_ngcontent-%COMP%]   .time[_ngcontent-%COMP%]{font-size:3.6rem;font-weight:800}.doctor-dashboard[_ngcontent-%COMP%]   .date[_ngcontent-%COMP%]{font-size:1.05rem;font-weight:600}.apt-card[_ngcontent-%COMP%]{box-shadow:0 6px 18px #0206170d;border-radius:10px}.apt-card[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{padding:.45rem .7rem}@media (max-width: 576px){.apt-card[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start;gap:.5rem}.apt-card[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]{width:100%;justify-content:space-between}}.summary-card[_ngcontent-%COMP%]{max-width:420px;width:100%;border-radius:12px;box-shadow:0 8px 26px #02061714}.summary-card[_ngcontent-%COMP%]   .summary-title[_ngcontent-%COMP%]{font-weight:600;font-size:1.05rem;letter-spacing:.2px}.summary-card[_ngcontent-%COMP%]   .summary-count[_ngcontent-%COMP%]{font-weight:800;font-size:3.25rem;color:#0d6efd}.summary-card[_ngcontent-%COMP%]   .summary-sub[_ngcontent-%COMP%]{margin-top:6px}.doctor-dashboard[_ngcontent-%COMP%]   .hero[_ngcontent-%COMP%]{margin-bottom:1.5rem}.doctor-dashboard[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin-bottom:1.25rem}.appointments-summary[_ngcontent-%COMP%]{margin-top:.75rem;margin-bottom:1.6rem}.doctor-dashboard[_ngcontent-%COMP%]   .summary-card[_ngcontent-%COMP%]{padding:1.6rem}.mission-vision[_ngcontent-%COMP%]{gap:1.25rem;margin-top:1.4rem}.mission-vision[_ngcontent-%COMP%]   .col-md-6[_ngcontent-%COMP%]{display:flex}.mission-vision[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]{width:100%;padding:1rem;margin-bottom:.8rem;box-shadow:0 6px 18px #0206170a;border-radius:10px}.mission-vision[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   .card-body[_ngcontent-%COMP%]{padding-top:.5rem}.mission-vision[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%] + .card[_ngcontent-%COMP%]{margin-top:.5rem}@media (max-width: 576px){.summary-card[_ngcontent-%COMP%]   .summary-count[_ngcontent-%COMP%]{font-size:2.2rem}.summary-card[_ngcontent-%COMP%]{padding:1rem}}"]})}return g})()}}]);
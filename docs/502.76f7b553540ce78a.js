"use strict";(self.webpackChunkdermatologia_app=self.webpackChunkdermatologia_app||[]).push([[502],{3121:(k,h,c)=>{c.r(h),c.d(h,{SecretaryDashboardComponent:()=>O});var p=c(2200),d=c(9417),g=c(2615),t=c(3664),f=c(547),_=c(8397),b=c(9330);const C=(o,m)=>({"text-success":o,"text-danger":m});function v(o,m){1&o&&(t.j41(0,"div",6),t.EFF(1,"Cargando citas..."),t.k0s())}function P(o,m){if(1&o){const e=t.RV6();t.j41(0,"div")(1,"div",31),t.bIt("click",function(){const i=g.eBV(e).$implicit,r=t.XpG();return g.Njj(r.isSelectable(i)?r.selectAppointment(i.idCitas||i.idcitas||i.id):null)}),t.j41(2,"div",32)(3,"div")(4,"strong"),t.EFF(5),t.k0s(),t.EFF(6),t.k0s(),t.j41(7,"div",7),t.EFF(8),t.k0s(),t.j41(9,"div",33)(10,"span",34),t.EFF(11),t.k0s(),t.j41(12,"span",35),t.EFF(13),t.k0s()()(),t.j41(14,"div",36)(15,"input",37),t.bIt("change",function(){const i=g.eBV(e).$implicit,r=t.XpG();return g.Njj(r.selectAppointment(i.idCitas||i.idcitas||i.id))}),t.k0s()()()()}if(2&o){const e=m.$implicit,n=t.XpG();t.R7$(),t.AVh("disabled",!n.isSelectable(e)),t.R7$(4),t.JRh(n.getDateDisplay(e)),t.R7$(),t.SpI(" - ",n.getTimeDisplay(e)),t.R7$(2),t.Lme("Paciente: ",n.displayPatientName(e)," \u2022 M\xe9dico: ",n.displayDoctorName(e)),t.R7$(2),t.Y8G("ngClass",n.getStatusClass(e)),t.R7$(),t.JRh(n.getStatus(e)||"\u2014"),t.R7$(2),t.JRh(e.especialidadNombre||e.especialidadnombre||e.especialidadInfo&&e.especialidadInfo.Nombre||""),t.R7$(2),t.Y8G("disabled",!n.isSelectable(e))("checked",n.selectedAppointmentId===(e.idCitas||e.idcitas||e.id))}}function M(o,m){if(1&o&&(t.j41(0,"option",38),t.EFF(1),t.k0s()),2&o){const e=m.$implicit;t.Y8G("value",e),t.R7$(),t.JRh(e)}}function y(o,m){if(1&o&&(t.j41(0,"div",39),t.EFF(1,"Estado: "),t.j41(2,"strong",40),t.EFF(3),t.k0s()()),2&o){const e=t.XpG();t.R7$(2),t.Y8G("ngClass",t.l_i(2,C,e.available,!e.available)),t.R7$(),t.JRh(e.available?"Disponible":"Ocupado")}}let O=(()=>{class o{appointmentService;toast;http;appointments=[];loading=!1;page=1;limit=25;dateFilter=null;statusFilter=null;timeString="";dateString="";use24Hour=!0;_clockInterval=null;selectedAppointmentId=null;selectedAppointment=null;newDate="";newTime="";availabilityChecked=!1;available=!1;allTimes=["09:00","09:30","10:00","10:30","11:00","11:30","12:00","12:30","13:00","15:00","15:30","16:00","16:30","17:00","17:30","18:00"];availableTimes=[];debugResp=null;showDebug=!1;missionText="";visionText="";constructor(e,n,i){this.appointmentService=e,this.toast=n,this.http=i}ngOnInit(){this.loadAppointments(),this.loadClockPreference(),this.startClock(),this.loadMissionVision()}loadMissionVision(){try{this.http.get("/api/settings/mission").subscribe({next:e=>{this.missionText=e&&e.value?e.value:""},error:e=>{console.error("Error loading mission for secretary dashboard",e),this.missionText=""}})}catch(e){console.warn(e)}try{this.http.get("/api/settings/vision").subscribe({next:e=>{this.visionText=e&&e.value?e.value:""},error:e=>{console.error("Error loading vision for secretary dashboard",e),this.visionText=""}})}catch(e){console.warn(e)}}ngOnDestroy(){this._clockInterval&&(clearInterval(this._clockInterval),this._clockInterval=null)}startClock(){const e=()=>{const n=new Date;this.timeString=n.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!this.use24Hour}),this.dateString=n.toLocaleDateString([],{weekday:"long",year:"numeric",month:"long",day:"numeric"})};e(),this._clockInterval=setInterval(e,1e3)}clockPrefKey(){return"clockFormat:secretaria"}loadClockPreference(){try{this.use24Hour="12"!==localStorage.getItem(this.clockPrefKey())}catch{}}loadAppointments(){this.loading=!0,this.appointmentService.getCitasPaged(this.page,this.limit,this.dateFilter||void 0,this.statusFilter||void 0).subscribe({next:e=>{console.log("[SecretaryDashboard] raw response from getCitasPaged:",e),this.debugResp=e;const n=Array.isArray(e)?e:e&&e.data?e.data:e;this.appointments=(n||[]).filter(i=>this.isSelectable(i)),console.log("[SecretaryDashboard] filtered appointments:",this.appointments),this.loading=!1},error:e=>{console.error("Error loading citas paged",e),this.toast.show("Error cargando citas"),this.loading=!1}})}confirm(e){this.appointmentService.confirmAppointment(e).subscribe({next:()=>{this.toast.show("Cita confirmada"),this.loadAppointments()},error:n=>{this.toast.show("Error confirmando cita"),console.error(n)}})}cancel(e){this.appointmentService.cancelAppointment(e).subscribe({next:()=>{this.toast.show("Cita cancelada"),this.loadAppointments()},error:n=>{this.toast.show("Error cancelando cita"),console.error(n)}})}selectAppointment(e){if(this.selectedAppointmentId=e,this.selectedAppointment=this.appointments.find(n=>String(n.idCitas||n.idcitas||n.id)===String(e))||null,this.availabilityChecked=!1,this.available=!1,this.selectedAppointment){let n=this.selectedAppointment.fecha||this.selectedAppointment.Fecha||this.selectedAppointment.date;n&&n.length>10&&(n=n.slice(0,10)),this.newDate=n||"",this.newTime=(this.selectedAppointment.hora||this.selectedAppointment.Hora||this.selectedAppointment.time||"").slice(0,5)||"";const i=this.getDoctorIdFromAppointment(this.selectedAppointment);console.log("[SecretaryDashboard] selectAppointment selected",{id:e,doctorId:i,newDate:this.newDate,newTime:this.newTime,selectedAppointment:this.selectedAppointment}),this.updateAvailableTimes(i,this.newDate)}}getDoctorIdFromAppointment(e){if(!e)return null;const n=[e.Profesional_Responsable,e.profesional_Responsable,e.profesionalResponsable,e.profesional_responsable,e.doctorId,e.doctor_id,e.medicoId,e.medico,e.doctor&&(e.doctor.id||e.doctor._id||e.doctor.userId)];for(const i of n)if(null!=i&&""!==i)return i;return null}displayPatientName(e){if(!e)return"";const n=e.pacienteNombres||e.pacienteNombre||e.pacientenombres||e.paciente_nombres||e.Paciente_Nombres||e.patientName||e.paciente&&(e.paciente.nombres||e.paciente.Nombre)||e.pacienteInfo&&e.pacienteInfo.nombres,i=e.pacienteApellidos||e.pacienteapellidos||e.paciente_apellidos||e.Paciente_Apellidos||e.paciente&&(e.paciente.apellidos||e.paciente.Apellidos)||e.pacienteInfo&&e.pacienteInfo.apellidos;return n||i?((n||"")+" "+(i||"")).trim():e.paciente&&(e.paciente.nombres||e.paciente.name||e.paciente.fullName)||e.paciente||""}displayDoctorName(e){if(!e)return"";const n=e.doctorNombres||e.doctorNombre||e.doctornombres||e.doctor_nombres||e.Doctor_Nombres||e.doctorName||e.doctor&&(e.doctor.nombres||e.doctor.Nombre)||e.doctorInfo&&e.doctorInfo.nombres,i=e.doctorApellidos||e.doctorapellidos||e.doctor_apellidos||e.Doctor_Apellidos||e.doctor&&(e.doctor.apellidos||e.doctor.Apellidos)||e.doctorInfo&&e.doctorInfo.apellidos;return n||i?((n||"")+" "+(i||"")).trim():e.medico&&(e.medico.nombres||e.medico.name||e.medico.fullName)||e.medico||""}getDateDisplay(e){if(!e)return"";let n=e.fecha||e.Fecha||e.date;if(!n)return"-";if("string"==typeof n&&n.length>10&&(n=n.slice(0,10)),"string"==typeof n&&n.includes("-")){const i=n.split("-");if(3===i.length)return`${i[2]}/${i[1]}/${i[0]}`}try{const i=new Date(n);if(!isNaN(i.getTime()))return i.toLocaleDateString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric"})}catch{}return String(n)}getTimeDisplay(e){if(!e)return"";let n=e.hora||e.Hora||e.time;return n?(n=String(n),n.length>=5?n.slice(0,5):n):"-"}getStatus(e){if(!e)return"";const n=e.Confirmado||e.confirmado||e.estado||e.Estado||e.status||e.Status||"",i=String(n).toLowerCase();if(i.includes("pend"))return"Pendiente";if(i.includes("confirm"))return"Confirmada";if(i.includes("cancel"))return"Cancelada";if(!n)return"";try{return String(n).charAt(0).toUpperCase()+String(n).slice(1)}catch{return String(n)}}getStatusClass(e){const n=(this.getStatus(e)||"").toLowerCase();return"pendiente"===n?"bg-warning text-dark":"confirmada"===n?"bg-success":"cancelada"===n?"bg-danger":"bg-secondary"}isSelectable(e){if(!e)return!1;const n=e.Confirmado||e.confirmado||e.estado||e.Estado||e.status||e.Status;if(null==n)return!1;const i=String(n).toLowerCase();return!i.includes("cancel")&&(i.includes("pendient")||i.includes("confirm")||"si"===i||"s\xed"===i||"true"===i||"1"===i)}checkAvailability(){}onTimeChange(){if(!this.selectedAppointment||!this.newDate||!this.newTime)return this.availabilityChecked=!1,void(this.available=!1);const e=this.selectedAppointment,n=this.getDoctorIdFromAppointment(e);if(console.log("[SecretaryDashboard] onTimeChange",{doctorId:n,date:this.newDate,time:this.newTime,availableTimes:this.availableTimes}),!n)return this.availabilityChecked=!0,void(this.available=!1);if(this.availableTimes&&this.availableTimes.length>0){const i=this.availableTimes.includes(this.newTime)||this.newTime===(e.hora||e.Hora||e.time);return this.availabilityChecked=!0,void(this.available=!!i)}this.appointmentService.checkDoctorAvailability(n,this.newDate,this.newTime).subscribe({next:i=>{this.availabilityChecked=!0,this.available=!!i},error:i=>{console.error(i),this.availabilityChecked=!0,this.available=!1}})}reschedule(){this.selectedAppointmentId&&this.newDate&&this.newTime?this.availabilityChecked&&this.available?this.appointmentService.rescheduleAppointment(this.selectedAppointmentId,this.newDate,this.newTime).subscribe({next:()=>{this.toast.show("Cita reprogramada"),this.loadAppointments(),this.selectedAppointmentId=null,this.newDate="",this.newTime="",this.availabilityChecked=!1,this.available=!1},error:e=>{console.error(e),this.toast.show("Error reprogramando cita")}}):this.toast.show("Verifica disponibilidad antes de reprogramar"):this.toast.show("Selecciona una cita y la nueva fecha/hora")}updateAvailableTimes(e,n){e&&n?this.appointmentService.getCitasPorDoctor(e).subscribe({next:i=>{const l=(i.citas||i||[]).filter(a=>{let s=a.Fecha||a.fecha||a.date;s&&s.length>10&&(s=s.slice(0,10));const u=a.Confirmado||a.confirmado||a.Estado||a.estado||a.status||"",D="cancelada"===String(u).toLowerCase()||"cancelado"===String(u).toLowerCase();return s===n&&!D}).map(a=>{let s=a.Hora||a.hora||a.time;return s&&s.length>=5&&(s=s.slice(0,5)),s});this.availableTimes=this.allTimes.filter(a=>!l.includes(a)),console.log("[SecretaryDashboard] updateAvailableTimes",{doctorId:e,date:n,ocupadas:l,availableTimes:this.availableTimes})},error:i=>{console.error("Error obteniendo citas por doctor",i),this.availableTimes=[...this.allTimes]}}):this.availableTimes=[...this.allTimes]}prevPage(){this.page>1&&(this.page--,this.loadAppointments())}nextPage(){this.page++,this.loadAppointments()}static \u0275fac=function(n){return new(n||o)(t.rXU(f.h),t.rXU(_.f),t.rXU(b.Qq))};static \u0275cmp=t.VBU({type:o,selectors:[["app-secretary-dashboard"]],decls:56,vars:10,consts:[[1,"secretary-dashboard","container","py-3"],[1,"patient-hero","d-flex","flex-column","align-items-center","justify-content-center","py-3","mb-3"],[1,"hero-clock","w-100","d-flex","justify-content-center"],[1,"clock-wrapper","d-flex","align-items-center","flex-column","flex-sm-row"],[1,"clock-time"],[1,"clock-date","mt-2","mt-sm-0","ms-sm-3"],[1,"mb-3"],[1,"small","text-muted"],["class","mb-3",4,"ngIf"],[1,"appointments-list","mb-3"],[4,"ngFor","ngForOf"],[1,"reprogram-controls","mb-4"],[1,"row","g-2","align-items-center"],[1,"col-auto"],[1,"form-label"],["type","date",1,"form-control",3,"ngModelChange","change","ngModel"],[1,"form-select",3,"ngModelChange","change","ngModel"],["value",""],[3,"value",4,"ngFor","ngForOf"],[1,"col-auto","d-flex","align-items-end"],[1,"btn","btn-primary",3,"click"],[1,"col-12","mt-2"],["class","small",4,"ngIf"],[1,"pagination-controls","mt-3"],[1,"btn","btn-outline-secondary",3,"click"],[1,"mission-vision","row","g-3","mt-4"],[1,"col-md-6","mb-3"],[1,"card","p-3"],[1,"card-header","pb-2"],[1,"card-body","pt-1"],[1,"mb-0"],[1,"appointment-item","p-2","mb-2","d-flex","align-items-center","justify-content-between",3,"click"],[1,"appointment-info"],[1,"mt-1"],[1,"badge","me-1",3,"ngClass"],[1,"badge","specialidad-badge"],[1,"form-check"],["type","radio","name","selectedApt",1,"form-check-input",3,"change","disabled","checked"],[3,"value"],[1,"small"],[3,"ngClass"]],template:function(n,i){1&n&&(t.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4),t.EFF(5),t.k0s(),t.j41(6,"div",5),t.EFF(7),t.k0s()()()(),t.j41(8,"div",6)(9,"h4"),t.EFF(10,"Reprogramar Cita"),t.k0s(),t.j41(11,"div",7),t.EFF(12,"Selecciona una cita (estado pendiente o confirmada) y elige nueva fecha y hora."),t.k0s()(),t.DNE(13,v,2,0,"div",8),t.j41(14,"div",9),t.DNE(15,P,16,11,"div",10),t.k0s(),t.j41(16,"div",11)(17,"div",12)(18,"div",13)(19,"label",14),t.EFF(20,"Nueva fecha"),t.k0s(),t.j41(21,"input",15),t.mxI("ngModelChange",function(l){return t.DH7(i.newDate,l)||(i.newDate=l),l}),t.bIt("change",function(){return i.selectedAppointment&&i.updateAvailableTimes(i.getDoctorIdFromAppointment(i.selectedAppointment),i.newDate)}),t.k0s()(),t.j41(22,"div",13)(23,"label",14),t.EFF(24,"Nuevo horario"),t.k0s(),t.j41(25,"select",16),t.mxI("ngModelChange",function(l){return t.DH7(i.newTime,l)||(i.newTime=l),l}),t.bIt("change",function(){return i.onTimeChange()}),t.j41(26,"option",17),t.EFF(27,"-- Selecciona --"),t.k0s(),t.DNE(28,M,2,2,"option",18),t.k0s()(),t.j41(29,"div",19)(30,"button",20),t.bIt("click",function(){return i.reschedule()}),t.EFF(31,"Reprogramar"),t.k0s()(),t.j41(32,"div",21),t.DNE(33,y,4,5,"div",22),t.k0s()()(),t.j41(34,"div",23)(35,"button",24),t.bIt("click",function(){return i.prevPage()}),t.EFF(36,"Anterior"),t.k0s(),t.j41(37,"button",24),t.bIt("click",function(){return i.nextPage()}),t.EFF(38,"Siguiente"),t.k0s()(),t.j41(39,"div",25)(40,"div",26)(41,"div",27)(42,"div",28)(43,"strong"),t.EFF(44,"Misi\xf3n"),t.k0s()(),t.j41(45,"div",29)(46,"p",30),t.EFF(47),t.k0s()()()(),t.j41(48,"div",26)(49,"div",27)(50,"div",28)(51,"strong"),t.EFF(52,"Visi\xf3n"),t.k0s()(),t.j41(53,"div",29)(54,"p",30),t.EFF(55),t.k0s()()()()()()),2&n&&(t.R7$(5),t.JRh(i.timeString),t.R7$(2),t.JRh(i.dateString),t.R7$(6),t.Y8G("ngIf",i.loading),t.R7$(2),t.Y8G("ngForOf",i.appointments),t.R7$(6),t.R50("ngModel",i.newDate),t.R7$(4),t.R50("ngModel",i.newTime),t.R7$(3),t.Y8G("ngForOf",i.availableTimes),t.R7$(5),t.Y8G("ngIf",i.availabilityChecked),t.R7$(14),t.JRh(i.missionText||"No definida"),t.R7$(8),t.JRh(i.visionText||"No definida"))},dependencies:[p.MD,p.YU,p.Sq,p.bT,d.YN,d.xH,d.y7,d.me,d.wz,d.BC,d.vS],styles:[".secretary-dashboard[_ngcontent-%COMP%]{padding:0 1rem}.secretary-dashboard[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 .5rem}.secretary-dashboard[_ngcontent-%COMP%]   .filters[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .secretary-dashboard[_ngcontent-%COMP%]   .filters[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{min-width:160px}.secretary-dashboard[_ngcontent-%COMP%]   .table[_ngcontent-%COMP%]{background:#fff}.secretary-dashboard[_ngcontent-%COMP%]   .btn-sm[_ngcontent-%COMP%]{padding:.4rem .9rem;font-size:.95rem}.patient-hero[_ngcontent-%COMP%]{gap:1.5rem;display:flex;align-items:center;justify-content:center;padding:1.25rem;background:linear-gradient(90deg,#45b6650f,#53c06f08);border-radius:12px}.clock-wrapper[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1.2rem}.clock-time[_ngcontent-%COMP%]{font-size:2.6rem;line-height:1;font-weight:900;color:var(--brand-700);text-shadow:0 2px 6px rgba(0,0,0,.06)}.clock-date[_ngcontent-%COMP%]{font-size:1rem;color:#374151;opacity:.95}.appointments-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.85rem}.appointments-list[_ngcontent-%COMP%]   .appointment-item[_ngcontent-%COMP%]{background:#fff;border-radius:10px;box-shadow:0 8px 24px #0206170f;padding:.9rem 1rem;display:flex;align-items:center;justify-content:space-between;gap:1rem}.appointments-list[_ngcontent-%COMP%]   .appointment-item[_ngcontent-%COMP%]   .appointment-info[_ngcontent-%COMP%]{min-width:240px}.appointments-list[_ngcontent-%COMP%]   .appointment-item[_ngcontent-%COMP%]   .appointment-meta[_ngcontent-%COMP%]{font-size:.98rem;color:#374151}.appointments-list[_ngcontent-%COMP%]   .appointment-item[_ngcontent-%COMP%]   .small[_ngcontent-%COMP%]{font-size:.95rem}.appointments-list[_ngcontent-%COMP%]   .appointment-item.disabled[_ngcontent-%COMP%]{opacity:.55}.appointment-actions[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.6rem}.appointment-actions[_ngcontent-%COMP%]   .form-check-input[_ngcontent-%COMP%]{transform:scale(1.15);margin-right:.45rem}.specialidad-badge[_ngcontent-%COMP%]{display:inline-block;background:#6366f114;color:#4f46e5;border:1px solid rgba(99,102,241,.18);padding:.18rem .5rem;border-radius:999px;font-size:.82rem;font-weight:600}.mission-vision[_ngcontent-%COMP%]{margin-top:1.5rem}.mission-vision[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]{min-height:150px;padding:1rem;box-shadow:0 6px 18px #0206170a}.mission-vision[_ngcontent-%COMP%]   .col-md-6[_ngcontent-%COMP%]{padding-left:.75rem;padding-right:.75rem}.mission-vision[_ngcontent-%COMP%]   .col-md-6[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]{margin-bottom:1.25rem}@media (max-width: 768px){.mission-vision[_ngcontent-%COMP%]   .col-md-6[_ngcontent-%COMP%]{padding-left:.5rem;padding-right:.5rem}.mission-vision[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]{min-height:120px}}.reprogram-controls[_ngcontent-%COMP%]   .form-label[_ngcontent-%COMP%]{font-size:.95rem;font-weight:600}.reprogram-controls[_ngcontent-%COMP%]   input[type=date][_ngcontent-%COMP%], .reprogram-controls[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{min-width:220px;padding:.55rem .7rem;font-size:1.02rem;border-radius:6px}.reprogram-controls[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{padding:.6rem 1rem;font-size:1.02rem}.d-flex.gap-2[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{padding:.45rem .85rem}.reprogram-controls[_ngcontent-%COMP%]   .row[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;align-items:center;gap:1rem!important;margin-top:.4rem}.reprogram-controls[_ngcontent-%COMP%]   .col-auto[_ngcontent-%COMP%]{margin-right:0}.reprogram-controls[_ngcontent-%COMP%]   .col-auto[_ngcontent-%COMP%]:last-child{margin-right:0}.reprogram-controls[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{margin-left:.4rem}.pagination-controls[_ngcontent-%COMP%]{display:flex;gap:1rem;margin-top:1.2rem}.pagination-controls[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{min-width:120px}@media (max-width: 576px){.reprogram-controls[_ngcontent-%COMP%]   .col-auto[_ngcontent-%COMP%]{width:100%;margin-right:0}.reprogram-controls[_ngcontent-%COMP%]{row-gap:.6rem}.pagination-controls[_ngcontent-%COMP%]{justify-content:space-between}}.reprogram-controls[_ngcontent-%COMP%]   .form-label[_ngcontent-%COMP%]{font-size:.85rem}"]})}return o})()}}]);
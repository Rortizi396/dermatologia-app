"use strict";(self.webpackChunkdermatologia_app=self.webpackChunkdermatologia_app||[]).push([[933],{6933:(B,p,n)=>{n.r(p),n.d(p,{PrescriptionDetailComponent:()=>$});var u=n(4523),l=n(2200),g=n(8132),E=n(3985),P=n(7239),D=n.n(P),m=n(2615),t=n(3664),F=n(5114),x=n(4882),I=n(3711),R=n(4796),C=n(8397);const O=i=>[i];function M(i,a){if(1&i&&(t.j41(0,"div",10),t.EFF(1),t.k0s()),2&i){const e=t.XpG(2);t.R7$(),t.JRh(e.error)}}function b(i,a){if(1&i&&(t.j41(0,"div",25)(1,"div")(2,"strong"),t.EFF(3),t.k0s()(),t.j41(4,"div",16),t.EFF(5),t.k0s(),t.j41(6,"div",16),t.EFF(7),t.k0s(),t.nrm(8,"div",26),t.k0s()),2&i){const e=a.$implicit;t.R7$(3),t.JRh(e.nombre),t.R7$(2),t.SpI("",e.cantidad," unidades"),t.R7$(2),t.JRh(e.dosis)}}function j(i,a){if(1&i&&(t.j41(0,"div",27)(1,"div",28),t.EFF(2,"Otras indicaciones"),t.k0s(),t.j41(3,"div",16),t.EFF(4),t.k0s()()),2&i){const e=t.XpG(3);t.R7$(4),t.JRh(e.receta.observaciones)}}function k(i,a){if(1&i&&(t.j41(0,"div",11)(1,"div",12)(2,"div",13),t.nrm(3,"img",14),t.j41(4,"div")(5,"div",15),t.EFF(6,"Centro Dermatol\xf3gico"),t.k0s(),t.j41(7,"div",16),t.EFF(8),t.k0s(),t.j41(9,"div",16),t.EFF(10),t.k0s(),t.j41(11,"div",16),t.EFF(12),t.k0s()()(),t.j41(13,"div",17)(14,"div")(15,"strong"),t.EFF(16),t.k0s()(),t.j41(17,"div"),t.EFF(18),t.k0s()()(),t.nrm(19,"hr"),t.j41(20,"div",16)(21,"strong"),t.EFF(22,"Paciente"),t.k0s(),t.EFF(23," __________________________________________"),t.k0s(),t.j41(24,"div",18),t.DNE(25,b,9,3,"div",19)(26,j,5,1,"div",20),t.k0s(),t.j41(27,"div",21)(28,"strong"),t.EFF(29,"Paciente:"),t.k0s(),t.EFF(30),t.k0s(),t.j41(31,"div",22),t.nrm(32,"div",23),t.j41(33,"div",24),t.EFF(34),t.k0s()()()),2&i){const e=t.XpG(2);t.R7$(3),t.Y8G("src",e.logoPath,t.B4B),t.R7$(5),t.JRh(e.clinicAddress),t.R7$(2),t.SpI("Tel\xe9fono: ",e.clinicPhone),t.R7$(2),t.SpI("Correo: ",e.receta.doctor_correo||"\u2014"),t.R7$(4),t.SpI("Dr(a). ",e.receta.doctor_nombre||"\u2014"),t.R7$(2),t.SpI("Fecha: ",e.receta.fecha),t.R7$(7),t.Y8G("ngForOf",e.receta.items),t.R7$(),t.Y8G("ngIf",e.receta.observaciones),t.R7$(4),t.SpI(" ",e.displayPatient()),t.R7$(4),t.SpI("Firma Dr(a). ",e.receta.doctor_nombre||"\u2014")}}function T(i,a){if(1&i){const e=t.RV6();t.j41(0,"div",2)(1,"div",3)(2,"h5",4),t.EFF(3,"Detalle de receta"),t.k0s(),t.j41(4,"div",5)(5,"a",6),t.EFF(6,"Regresar"),t.k0s(),t.j41(7,"button",7),t.bIt("click",function(){m.eBV(e);const r=t.XpG();return m.Njj(r.reprintPdf())}),t.EFF(8,"Reimprimir PDF"),t.k0s()()(),t.DNE(9,M,2,1,"div",8)(10,k,35,10,"div",9),t.k0s()}if(2&i){const e=t.XpG();t.R7$(5),t.Y8G("routerLink",t.eq3(3,O,e.backUrl)),t.R7$(4),t.Y8G("ngIf",e.error),t.R7$(),t.Y8G("ngIf",!e.error&&e.receta)}}function U(i,a){1&i&&(t.j41(0,"div",29),t.EFF(1,"Cargando..."),t.k0s())}let $=(()=>{class i{route;rxSvc;patientsSvc;auth;toast;id;receta=null;loading=!1;error="";logoPath="assets/favicon.svg";clinicPhone="4265-8975";clinicAddress="4ta calle 13-47 zona 3, segundo nivel";paciente=null;backUrl="/doctor/recetas";constructor(e,o,r,c,s){this.route=e,this.rxSvc=o,this.patientsSvc=r,this.auth=c,this.toast=s}ngOnInit(){const e=this.auth.currentUserValue,o=(e?.tipo||e?.Tipo||"").toString().toLowerCase();this.backUrl="paciente"===o?"/paciente/recetas":"/doctor/recetas",this.loading=!0;const r=this.route.snapshot.paramMap.get("id");if(this.id=r?parseInt(r,10):NaN,!this.id||isNaN(this.id))return this.error="ID inv\xe1lido",void(this.loading=!1);this.rxSvc.getById(this.id).subscribe({next:c=>{this.receta=c?.data||null,this.loading=!1,this.receta?.paciente_dpi&&this.patientsSvc.list(!1).subscribe(s=>{const _=String(this.receta.paciente_dpi);this.paciente=(s||[]).find(d=>String(d.DPI)===_)||null})},error:c=>{this.error="No se pudo cargar la receta",this.loading=!1}})}displayPatient(){return this.receta?this.paciente?`${`${this.paciente.Nombres||this.paciente.nombres||""} ${this.paciente.Apellidos||this.paciente.apellidos||""}`.trim()} \u2014 DPI: ${this.receta.paciente_dpi}`:`DPI: ${this.receta.paciente_dpi}`:""}reprintPdf(){var e=this;return(0,u.A)(function*(){try{const o=document.getElementById("rx-sheet");if(!o)return void e.toast.show("No se encontr\xf3 la plantilla de la receta","error");const r=yield D()(o,{scale:2,useCORS:!0,backgroundColor:"#ffffff"}),c=r.toDataURL("image/png"),s=new E.Ay("p","pt","letter"),_=s.internal.pageSize.getWidth(),d=s.internal.pageSize.getHeight(),v=Math.min(_/r.width,d/r.height),h=r.width*v,f=r.height*v;s.addImage(c,"PNG",(_-h)/2,(d-f)/2,h,f,void 0,"FAST");const A=e.receta?.fecha||(new Date).toISOString().slice(0,10);s.save(`receta_${A}.pdf`),e.toast.show("PDF generado correctamente")}catch(o){console.error("[PDF][reprint] error",o),e.toast.show("No se pudo generar el PDF","error")}})()}static \u0275fac=function(o){return new(o||i)(t.rXU(F.nX),t.rXU(x.q),t.rXU(I.X),t.rXU(R.u),t.rXU(C.f))};static \u0275cmp=t.VBU({type:i,selectors:[["app-prescription-detail"]],decls:2,vars:2,consts:[["class","container-xxl py-3",4,"ngIf"],["class","p-3",4,"ngIf"],[1,"container-xxl","py-3"],[1,"toolbar","d-flex","align-items-center","justify-content-between","p-2","mb-3","flex-wrap","gap-2"],[1,"m-0"],[1,"d-flex","align-items-center","gap-2"],[1,"btn","btn-outline-secondary",3,"routerLink"],[1,"btn","btn-primary",3,"click"],["class","alert alert-danger",4,"ngIf"],["id","rx-sheet","class","rx-sheet mt-3",4,"ngIf"],[1,"alert","alert-danger"],["id","rx-sheet",1,"rx-sheet","mt-3"],[1,"rx-header","d-flex","align-items-start","justify-content-between"],[1,"d-flex","align-items-center","gap-3"],["alt","logo",1,"rx-logo",3,"src"],[1,"fw-semibold"],[1,"small"],[1,"text-end","small"],[1,"rx-body","mt-3"],["class","rx-item",4,"ngFor","ngForOf"],["class","mt-3",4,"ngIf"],[1,"small","mt-2"],[1,"rx-footer"],[1,"signature"],[1,"small","text-center"],[1,"rx-item"],[1,"divider"],[1,"mt-3"],[1,"fw-semibold","mb-1"],[1,"p-3"]],template:function(o,r){1&o&&t.DNE(0,T,11,5,"div",0)(1,U,2,0,"div",1),2&o&&(t.Y8G("ngIf",!r.loading),t.R7$(),t.Y8G("ngIf",r.loading))},dependencies:[l.MD,l.Sq,l.bT,g.iI,g.Wk],styles:[".rx-sheet[_ngcontent-%COMP%]{background:#fff;border:1px solid #e5e7eb;border-radius:8px;padding:16px}.rx-logo[_ngcontent-%COMP%]{width:42px;height:42px}.rx-header[_ngcontent-%COMP%]   .small[_ngcontent-%COMP%]{color:#6b7280}.rx-item[_ngcontent-%COMP%]   .divider[_ngcontent-%COMP%]{border-bottom:1px dashed #e5e7eb;margin:8px 0}.rx-footer[_ngcontent-%COMP%]{margin-top:40px}.rx-footer[_ngcontent-%COMP%]   .signature[_ngcontent-%COMP%]{height:42px;border-bottom:1px solid #111;margin:0 80px}"]})}return i})()}}]);